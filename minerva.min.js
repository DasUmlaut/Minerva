var Minerva={};Minerva.blendmodes={},Minerva.mixmodes={},Minerva.convert={},Minerva.util={},Minerva.settings={lumaR:.3,lumaG:.59,lumaB:.11},Minerva.util.getAverageTotal=function(r){if(r instanceof Minerva.image){var n=0,e=0,t=0;for(i=0;i<r.width*r.height;i++){var a=r.getColorAt(i);n+=a.r,e+=a.g,t+=a.b}return{r:n/(r.width*r.height),g:e/(r.width*r.height),b:t/(r.width*r.height)}}},Minerva.util.getAverageVisible=function(r){if(r instanceof Minerva.image){var n=0,e=0,t=0,a=0;for(i=0;i<r.width*r.height;i++){var v=r.getColorAt(i),o=r.getAlphaAt(i);n+=v.r*o,e+=v.g*o,t+=v.b*o,a+=o.a}return{r:n/(r.width*r.height)/a,g:e/(r.width*r.height)/a,b:t/(r.width*r.height)/a}}},Minerva.channel=function(){var r=[];this.add=function(n){r.push(n)},this.set=function(n){n instanceof Minerva.channel&&(r=n.get())},this.setAt=function(n,e){r[n]=e},this.get=function(){return r},this.getAt=function(n){return r[n]}},Minerva.image=function(){this.width=0,this.height=0;var r=new Minerva.channel,n=new Minerva.channel,e=new Minerva.channel,t=new Minerva.channel;this.getChannel=function(a){return"r"==a?r:"g"==a?n:"b"==a?e:"a"==a?t:void 0},this.setChannel=function(a,i){"r"==a?r=i:"g"==a?n=i:"b"==a?e=i:"a"==a&&(t=i)},this.setSize=function(r,n){this.width=r,this.height=n},this.getColorAt=function(t){return{r:r.getAt(t),g:n.getAt(t),b:e.getAt(t)}},this.getAlphaAt=function(r){return t.getAt(r)},this.setColorAt=function(t,a){r.setAt(t,Math.min(1,Math.max(0,a.r))),n.setAt(t,Math.min(1,Math.max(0,a.g))),e.setAt(t,Math.min(1,Math.max(0,a.b)))},this.setAlphaAt=function(r,n){t.setAt(r,Math.min(1,Math.max(0,n)))},this.fromUrl=function(r){var n=new Image;n.src=r,this.fromImage(n)},this.fromImage=function(a){this.width=a.width,this.height=a.height;var i=document.createElement("canvas");i.width=this.width,i.height=this.height;var v=i.getContext("2d");v.drawImage(a,0,0);for(var o=v.getImageData(0,0,this.width,this.height),h=0;h<o.data.length/4;h++)r.add(o.data[4*h+0]/255),n.add(o.data[4*h+1]/255),e.add(o.data[4*h+2]/255),t.add(o.data[4*h+3]/255)},this.toCanvas=function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height;for(var i=a.getContext("2d"),v=i.createImageData(this.width,this.height),o=0;o<v.data.length/4;o++)v.data[4*o+0]=255*r.getAt(o)&255,v.data[4*o+1]=255*n.getAt(o)&255,v.data[4*o+2]=255*e.getAt(o)&255,v.data[4*o+3]=255*t.getAt(o)&255;return i.putImageData(v,0,0),a},this.toFileData=function(){var r=this.toCanvas(),n=r.toDataURL();return n.replace("data:image/png;base64,","")}},Minerva.blend=function(r,n,e,t,a,i){null==t&&(t=1),null==e&&(e="normal"),null==i&&(i="clip"),e=e.toLowerCase(),i=i.toLowerCase();var v=Minerva.blendmodes.normal,o=Minerva.blendmodes.clip,h="b";null!=e&&(hasOwnProperty.call(Minerva.blendmodes,e)?v=Minerva.blendmodes[e]:hasOwnProperty.call(Minerva.mixmodes,e)&&(v=Minerva.mixmodes[e],h="m")),null!=i&&hasOwnProperty.call(Minerva.blendmodes,i)&&(o=Minerva.blendmodes[i]);var c=0,s=0,g=0;if(r instanceof Minerva.image)c=2;else{if("number"!=typeof r)return;c=1}if(n instanceof Minerva.image)s=2,null==a&&(a=n.getChannel("a"),g=1);else{if("number"!=typeof n)return;s=1}if(a instanceof Minerva.channel&&(g=1),1==c&&1==s){var u={},M=Minerva.convert.hex2rgb(r),b=Minerva.convert.hex2rgb(n);return u="b"==h?{r:v(M.r,b.r),g:v(M.g,b.g),b:v(M.b,b.b)}:v(M,b)}if(2==c&&1==s){var l=new Minerva.image;l.setSize(r.width,r.height);for(var d=0;d<r.width*r.height;d++){var u={},M=r.getColorAt(d),b=Minerva.convert.hex2rgb(n);u="b"==h?{r:v(M.r,b.r),g:v(M.g,b.g),b:v(M.b,b.b)}:v(M,b);var m=o(r.getAlphaAt(d),1),f=1;1==g?f=a.getAt(d)*t:0==g&&(f=t),l.setColorAt(d,{r:f*u.r+(1-f)*r.getColorAt(d).r,g:f*u.g+(1-f)*r.getColorAt(d).g,b:f*u.b+(1-f)*r.getColorAt(d).b}),l.setAlphaAt(d,m)}return l}if(1==c&&2==s){var l=new Minerva.image;l.setSize(r.width,r.height);for(var d=0;d<r.width*r.height;d++){var u={},M=Minerva.convert.hex2rgb(r),b=n.getColorAt(d);u="b"==h?{r:v(M.r,b.r),g:v(M.g,b.g),b:v(M.b,b.b)}:v(M,b);var m=o(1,n.getAlphaAt(d)),f=1;1==g?f=a.getAt(d)*t:0==g&&(f=t),l.setColorAt(d,{r:f*u.r+(1-f)*Minerva.convert.hex2rgb(r).r,g:f*u.g+(1-f)*Minerva.convert.hex2rgb(r).g,b:f*u.b+(1-f)*Minerva.convert.hex2rgb(r).b}),l.setAlphaAt(d,m)}return l}if(2==c&&2==c&&r.width==n.width&&r.height==n.height){var l=new Minerva.image;l.setSize(r.width,r.height);for(var d=0;d<r.width*r.height;d++){var u={},M=r.getColorAt(d),b=n.getColorAt(d);u="b"==h?{r:v(M.r,b.r),g:v(M.g,b.g),b:v(M.b,b.b)}:v(M,b);var m=o(r.getAlphaAt(d),n.getAlphaAt(d)),f=1;1==g?f=a.getAt(d)*t:1==g&&(f=t),l.setColorAt(d,{r:f*u.r+(1-f)*r.getColorAt(d).r,g:f*u.g+(1-f)*r.getColorAt(d).g,b:f*u.b+(1-f)*r.getColorAt(d).b}),l.setAlphaAt(d,m)}return l}},Minerva.convert.hex2rgb=function(r){var n=r>>16&255,e=r>>8&255,t=255&r;return{r:n/255,g:e/255,b:t/255}},Minerva.convert.rgb2cmyk=function(r){var n=Math.min(1-r.r,1-r.g,1-r.b);return{c:1==n?0:(1-r.r-n)/(1-n),m:1==n?0:(1-r.g-n)/(1-n),y:1==n?0:(1-r.b-n)/(1-n),k:n}},Minerva.convert.cmyk2rgb=function(r){return{r:1-Math.min(1,r.c*(1-r.k)+r.k),g:1-Math.min(1,r.m*(1-r.k)+r.k),b:1-Math.min(1,r.y*(1-r.k)+r.k)}},Minerva.convert.rgb2hsv=function(r){var n=Math.min(r.r,r.g,r.b),e=Math.max(r.r,r.g,r.b),t=e-n,a=0,i=0,v=e;if(0!=t){i=t/e;var o=((e-r.r)/6+t/2)/t,h=((e-r.g)/6+t/2)/t,c=((e-r.b)/6+t/2)/t;r.r==e?a=c-h:r.g==e?a=1/3+o-c:r.b==e&&(a=2/3+h-o),0>a&&(a+=1),a>1&&(a-=1)}return{h:a,s:i,v:v}},Minerva.convert.hsv2rgb=function(r){return 0==r.s?{r:r.v,g:r.v,b:r.v}:(var_h=6*r.h,var_i=Math.floor(var_h),var_1=r.v*(1-r.s),var_2=r.v*(1-r.s*(var_h-var_i)),var_3=r.v*(1-r.s*(1-(var_h-var_i))),0==var_i?(var_r=r.v,var_g=var_3,var_b=var_1):1==var_i?(var_r=var_2,var_g=r.v,var_b=var_1):2==var_i?(var_r=var_1,var_g=r.v,var_b=var_3):3==var_i?(var_r=var_1,var_g=var_2,var_b=r.v):4==var_i?(var_r=var_3,var_g=var_1,var_b=r.v):(var_r=r.v,var_g=var_1,var_b=var_2),{r:var_r,g:var_g,b:var_b})},Minerva.convert.hsy2rgb=function(r){var n=0,e=0,t=0,a=0;return r.h>=0&&r.h<1/6?(a=r.s*r.h/(1/6),t=r.y-Minerva.settings.lumaR*r.s-Minerva.settings.lumaG*a,n=t+r.s,e=t+a):r.h>=1/6&&r.h<2/6?(a=r.s*(r.h-1/6)/(1/6),e=r.y+Minerva.settings.lumaB*r.s+Minerva.settings.lumaR*a,t=e-r.s,n=e-a):r.h>=2/6&&r.h<.5?(a=r.s*(r.h-2/6)/(1/6),n=r.y-Minerva.settings.lumaG*r.s-Minerva.settings.lumaB*a,e=n+r.s,t=n+a):r.h>=.5&&r.h<4/6?(a=r.s*(r.h-.5)/(1/6),t=r.y+Minerva.settings.lumaR*r.s+Minerva.settings.lumaG*a,n=t-r.s,e=t-a):r.h>=4/6&&r.h<5/6?(a=r.s*(r.h-4/6)/(1/6),e=r.y-Minerva.settings.lumaB*r.s-Minerva.settings.lumaR*a,t=e+r.s,n=e+r.k):(a=r.s*(r.h-5/6)/(1/6),n=r.y+Minerva.settings.lumaG*r.s+Minerva.settings.lumaB*a,e=n-r.s,t=n-r.k),{r:n,g:e,b:t}},Minerva.convert.rgb2hsy=function(n){var e=0,t=0,a=n.r*Minerva.settings.lumaR+n.g*Minerva.settings.lumaG+n.b*Minerva.settings.lumaB;return n.r==n.g&&n.g==n.b||(r>=g&&g>=b?(t=n.r-n.b,e=1/6*(n.g-n.b)/t):n.g>n.r&&n.r>=n.b?(t=n.g-n.b,e=1/6*(n.g-n.r)/t+1/6):n.g>=n.b&&n.b>n.r?(t=n.g-n.r,e=1/6*(n.b-n.r)/t+2/6):n.b>n.g&&n.g>n.r?(t=n.b-n.r,e=1/6*(n.b-n.g)/t+.5):n.b>n.r&&n.r>=n.g?(t=n.b-n.g,e=1/6*(n.r-n.g)/t+4/6):(t=n.r-n.g,e=1/6*(n.r-n.b)/t+5/6)),{h:e,s:Math.min(Math.max(t,0),1),y:Math.min(Math.max(a,0),1)}},Minerva.convert.rgb2xyz=function(r){var n=r.r,e=r.g,t=r.b;n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92;var a=.4124*n+.3576*e+.1805*t,i=.2126*n+.7152*e+.0722*t,v=.0193*n+.1192*e+.9505*t;return{x:a,y:i,z:v}},Minerva.convert.rgb2lab=function(r){var n=Minerva.convert.rgb2xyz(r),e=n.x/.95047,t=n.y/1,a=n.z/1.08883;e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116;var i=116*t-16,v=500*(e-t),o=200*(t-a);return{l:i,a:v,b:o}},Minerva.convert.lab2xyz=function(r){var n,e,t,a,i=r.l,v=r.a,o=r.b;return 8>=i?(e=100*i/903.3,a=7.787*(e/100)+16/116):(e=100*Math.pow((i+16)/116,3),a=Math.pow(e/100,1/3)),n=.008856>=n/95.047?n=95.047*(v/500+a-16/116)/7.787:95.047*Math.pow(v/500+a,3),t=.008859>=t/108.883?t=108.883*(a-o/200-16/116)/7.787:108.883*Math.pow(a-o/200,3),{x:n/100,y:e/100,z:t/100}},Minerva.convert.xyz2rgb=function(r){var n,e,t,a=r.x,i=r.y,v=r.z;return n=3.2406*a+-1.5372*i+v*-.4986,e=a*-.9689+1.8758*i+.0415*v,t=.0557*a+i*-.204+1.057*v,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,n=Math.min(Math.max(0,n),1),e=Math.min(Math.max(0,e),1),t=Math.min(Math.max(0,t),1),{r:n,g:e,b:t}},Minerva.convert.lab2rgb=function(r){return Minerva.convert.xyz2rgb(Minerva.convert.lab2xyz(r))},Minerva.convert.rgb2lch=function(r){return Minerva.convert.lab2lch(Minerva.convert.rgb2lab(r))},Minerva.convert.lch2rgb=function(r){return Minerva.convert.lab2rgb(Minerva.convert.lch2lab(r))},Minerva.convert.lab2lch=function(r){var n,e,t,a=r.l,i=r.a,v=r.b;return n=Math.atan2(v,i),e=360*n/2/Math.PI,0>e&&(e+=360),t=Math.sqrt(i*i+v*v),{l:a,c:t,h:e}},Minerva.convert.lch2lab=function(r){var n=r.h/360*2*Math.PI,e=r.c*Math.cos(n),t=r.c*Math.sin(n);return{l:r.l,a:e,b:t}},Minerva.preloader=new function(){var r=[],n={};this.add=function(n){if(Array.isArray(n))for(var e=0;e<n.length;e++)r.push(n[e]);else r.push(n)},this.getImages=function(){return n},this.onComplete=function(e){for(var t=0,a=function(){t++,t==r.length&&e()},i=0;i<r.length;i++){var v=new Image;v.addEventListener("load",a),v.src=r[i],n[r[i]]=v}}},Minerva.blendmodes.normal=function(r,n){return n},Minerva.blendmodes.ignore=function(r){return r},Minerva.blendmodes.clip=function(r){return r},Minerva.blendmodes.replace=function(r,n){return n},Minerva.blendmodes.discard=function(){return 1},Minerva.blendmodes.average=function(r,n){return(r+n)/2},Minerva.blendmodes.stamp=function(r,n){return r+2*n-1},Minerva.blendmodes.punch=function(r,n){return n+2*r-1},Minerva.blendmodes.darken=function(r,n){return Math.min(r,n)},Minerva.blendmodes.multiply=function(r,n){return r*n},Minerva.blendmodes.colorburn=function(r,n){return 0==n?0:1-(1-r)/n},Minerva.blendmodes.linearburn=function(r,n){return r+n-1},Minerva.blendmodes.softburn=function(r,n){return 1>n+r?1==r?1:n/2/(1-r):0==n?0:1-(1-r)/2/n},Minerva.blendmodes.lighten=function(r,n){return Math.max(r,n)},Minerva.blendmodes.screen=function(r,n){return 1-(1-r)*(1-n)},Minerva.blendmodes.lineardodge=function(r,n){return Math.min(1,r+n)},Minerva.blendmodes.colordodge=function(r,n){return 1==n?1:r/(1-n)},Minerva.blendmodes.softdodge=function(r,n){return 1>=r+n?1==n?1:r/2/(1-n):1-(1-n)/2/r},Minerva.blendmodes.difference=function(r,n){return Math.abs(r-n)},Minerva.blendmodes.negation=function(r,n){return 1-Math.abs(1-r-n)},Minerva.blendmodes.exclusion=function(r,n){return r+n-2*r*n},Minerva.blendmodes.divide=function(r,n){return 0==n?0:r/n},Minerva.blendmodes.subtract=function(r,n){return Math.max(0,Math.min(1,r-n))},Minerva.blendmodes.phoenix=function(r,n){return Math.min(r,n)-Math.max(r,n)+1},Minerva.blendmodes.inversesubtract=function(r,n){return n-(1-r)},Minerva.blendmodes.arctangent=function(r,n){return 0==r?0==n?0:1:2*Math.atan(r/n)/Math.PI},Minerva.blendmodes.parallel=function(r,n){return 0==r?1:0==n?1:2/(1/r+1/n)},Minerva.blendmodes.equivalence=function(r,n){return 1-Math.abs(r-n)},Minerva.blendmodes.grainmerge=function(r,n){return r+n-.5},Minerva.blendmodes.grainextract=function(r,n){return r-n+.5},Minerva.blendmodes.addsubtract=function(r,n){return Math.abs(Math.sqrt(r)-Math.sqrt(n))},Minerva.blendmodes.gammadark=function(r,n){return 0==n?0:Math.pow(r,1/n)},Minerva.blendmodes.gammalight=function(r,n){return 0==r?0:Math.pow(n,1/r)},Minerva.blendmodes.geometricmean=function(r,n){return Math.sqrt(r*n)},Minerva.blendmodes.softlightsvg=function(r,n){return r>.5?n+(2*r-1)*((n>.25?Math.sqrt(n):(16*n-12)*n+4)-n):n-(1-2*r)*n*(1-n)},Minerva.blendmodes.overlay=function(r,n){return r>.5?1-2*(1-n)*(1-r):2*n*r},Minerva.blendmodes.softlight=function(r,n){return.5>n?(1-2*n)*r*r+2*n*r:(1-(2*n-1))*r+(2*n-1)*Math.sqrt(r)},Minerva.blendmodes.peglight=function(r,n){return(1-r)*r*n+r*(1-(1-r)*(1-n))},Minerva.blendmodes.hardlight=function(r,n){return n>.5?1-2*(1-r)*(1-n):2*r*n},Minerva.blendmodes.linearlight=function(r,n){return n>.5?r+2*(n-.5):r+2*n-1},Minerva.blendmodes.vividlight=function(r,n){return.5>n?2*n==0?0:1-(1-r)/(2*n):2*(n-.5)==1?1:r/(1-2*(n-.5))},Minerva.blendmodes.pinlight=function(r,n){return 2*r-1>n?2*r-1:n>2*r-1&&2*r>n?n:2*r},Minerva.blendmodes.reflect=function(r,n){return 1==n?1:r*r/(1-n)>1?1:r*r/(1-n)},Minerva.blendmodes.glow=function(r,n){return 1==r?1:n*n/(1-r)>1?1:n*n/(1-r)},Minerva.blendmodes.freeze=function(r,n){return 0==n?0:1-(1-r)*(1-r)/n},Minerva.blendmodes.heat=function(r,n){return 0==r?0:1-(1-n)*(1-n)/r},Minerva.blendmodes.interpolation=function(r,n){return.5-.25*Math.cos(Math.PI*r)-.25*Math.cos(Math.PI*n)},Minerva.blendmodes.hardmix=function(r,n){return 1-n>r?0:1},Minerva.blendmodes.binaryand=function(r,n){return(255&Math.round(255*r)&(255&Math.round(255*n)))/255},Minerva.blendmodes.binaryor=function(r,n){return(255&Math.round(255*r)|255&Math.round(255*n))/255},Minerva.blendmodes.binaryxor=function(r,n){return(255&Math.round(255*r)^255&Math.round(255*n))/255},Minerva.blendmodes.binarynand=function(r,n){return(255&Math.round(255*r)&~(255&Math.round(255*n)))/255},Minerva.mixmodes.rgbRed=function(r,n){return{r:n.r,g:r.g,b:r.b}},Minerva.mixmodes.rgbGreen=function(r,n){return{r:r.r,g:n.g,b:r.b}},Minerva.mixmodes.rgbBlue=function(r,n){return{r:r.r,g:r.g,b:n.b}},Minerva.mixmodes.cmykcyan=function(r,n){var e=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(n);return Minerva.convert.cmyk2rgb({c:t.c,m:e.m,y:e.y,k:e.k})},Minerva.mixmodes.cmykmagenta=function(r,n){var e=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(n);return Minerva.convert.cmyk2rgb({c:e.c,m:t.m,y:e.y,k:e.k})},Minerva.mixmodes.cmykyellow=function(r,n){var e=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(n);return Minerva.convert.cmyk2rgb({c:e.c,m:e.m,y:t.y,k:e.k})},Minerva.mixmodes.cmykkey=function(r,n){var e=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(n);return Minerva.convert.cmyk2rgb({c:e.c,m:e.m,y:e.y,k:t.k})},Minerva.mixmodes.hsvhue=function(r,n){var e=Minerva.convert.rgb2hsv(r),t=Minerva.convert.rgb2hsv(n);return Minerva.convert.hsv2rgb({h:t.h,s:e.s,v:e.v})},Minerva.mixmodes.hsvsaturation=function(r,n){var e=Minerva.convert.rgb2hsv(r),t=Minerva.convert.rgb2hsv(n);return Minerva.convert.hsv2rgb({h:e.h,s:t.s,v:e.v})},Minerva.mixmodes.hsvvalue=function(r,n){var e=Minerva.convert.rgb2hsv(r),t=Minerva.convert.rgb2hsv(n);return Minerva.convert.hsv2rgb({h:e.h,s:e.s,v:t.v})},Minerva.mixmodes.hsyhue=function(r,n){var e=Minerva.convert.rgb2hsy(r),t=Minerva.convert.rgb2hsy(n);return Minerva.convert.hsy2rgb({h:t.h,s:e.s,y:e.y})},Minerva.mixmodes.hsysaturation=function(r,n){var e=Minerva.convert.rgb2hsy(r),t=Minerva.convert.rgb2hsy(n);return Minerva.convert.hsy2rgb({h:e.h,s:t.s,y:e.y})},Minerva.mixmodes.hsyluminance=function(r,n){var e=Minerva.convert.rgb2hsy(r),t=Minerva.convert.rgb2hsy(n);return Minerva.convert.hsy2rgb({h:e.h,s:e.s,y:t.y})},Minerva.mixmodes.labluminance=function(r,n){var e=Minerva.convert.rgb2lab(r),t=Minerva.convert.rgb2lab(n);return Minerva.convert.lab2rgb({l:t.l,a:e.a,b:e.b})},Minerva.mixmodes.labalpha=function(r,n){var e=Minerva.convert.rgb2lab(r),t=Minerva.convert.rgb2lab(n);return Minerva.convert.lab2rgb({l:e.l,a:t.a,b:e.b})},Minerva.mixmodes.labbeta=function(r,n){var e=Minerva.convert.rgb2lab(r),t=Minerva.convert.rgb2lab(n);return Minerva.convert.lab2rgb({l:e.l,a:e.a,b:t.b})},Minerva.mixmodes.lchluminance=function(r,n){var e=Minerva.convert.rgb2lch(r),t=Minerva.convert.rgb2lch(n);return Minerva.convert.lch2rgb({l:t.l,c:e.c,h:e.h})},Minerva.mixmodes.lchchroma=function(r,n){var e=Minerva.convert.rgb2lch(r),t=Minerva.convert.rgb2lch(n);return Minerva.convert.lch2rgb({l:e.l,c:t.c,h:e.h})},Minerva.mixmodes.lchhue=function(r,n){var e=Minerva.convert.rgb2lch(r),t=Minerva.convert.rgb2lch(n);return Minerva.convert.lch2rgb({l:e.l,c:e.c,h:t.h})};
