var Minerva={};Minerva.colormodes={},Minerva.alphamodes={},Minerva.convert={},Minerva.util={},Minerva.settings={lumaR:.3,lumaG:.59,lumaB:.11},Minerva.util.getAverageTotal=function(r){if(r instanceof Minerva.image){var a=0,n=0,t=0;for(i=0;i<r.width*r.height;i++){var e=r.getColorAt(i);a+=e.r,n+=e.g,t+=e.b}return{r:a/(r.width*r.height),g:n/(r.width*r.height),b:t/(r.width*r.height)}}},Minerva.util.getAverageVisible=function(r){if(r instanceof Minerva.image){var a=0,n=0,t=0,e=0;for(i=0;i<r.width*r.height;i++){var o=r.getColorAt(i),g=r.getAlphaAt(i);a+=o.r*g.a,n+=o.g*g.a,t+=o.b*g.a,e+=g.a}return{r:a/(r.width*r.height)/e,g:n/(r.width*r.height)/e,b:t/(r.width*r.height)/e}}},Minerva.channel=function(){var r=[];this.add=function(a){r.push(a)},this.set=function(a){a instanceof Minerva.channel&&(r=a.get())},this.setAt=function(a,n){r[a]=n},this.get=function(){return r},this.getAt=function(a){return r[a]}},Minerva.image=function(){this.width=0,this.height=0;var r=new Minerva.channel,a=new Minerva.channel,n=new Minerva.channel,t=new Minerva.channel;this.getChannel=function(e){return"r"==e?r:"g"==e?a:"b"==e?n:"a"==e?t:void 0},this.setChannel=function(e,o){"r"==e?r=o:"g"==e?a=o:"b"==e?n=o:"a"==e&&(t=o)},this.setSize=function(r,a){this.width=r,this.height=a},this.getColorAt=function(t){return{r:r.getAt(t),g:a.getAt(t),b:n.getAt(t)}},this.getAlphaAt=function(r){return{a:t.getAt(r)}},this.setColorAt=function(t,e){r.setAt(t,Math.min(1,Math.max(0,e.r))),a.setAt(t,Math.min(1,Math.max(0,e.g))),n.setAt(t,Math.min(1,Math.max(0,e.b)))},this.setAlphaAt=function(r,a){t.setAt(r,Math.min(1,Math.max(0,a)))},this.fromUrl=function(r){var a=new Image;a.src=r,this.fromImage(a)},this.fromImage=function(e){this.width=e.width,this.height=e.height;var o=document.createElement("canvas");o.width=this.width,o.height=this.height;var i=o.getContext("2d");i.drawImage(e,0,0);for(var g=i.getImageData(0,0,this.width,this.height),h=0;h<g.data.length/4;h++)r.add(g.data[4*h+0]/255),a.add(g.data[4*h+1]/255),n.add(g.data[4*h+2]/255),t.add(g.data[4*h+3]/255)},this.toCanvas=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;for(var o=e.getContext("2d"),i=o.createImageData(this.width,this.height),g=0;g<i.data.length/4;g++)i.data[4*g+0]=255*r.getAt(g)&255,i.data[4*g+1]=255*a.getAt(g)&255,i.data[4*g+2]=255*n.getAt(g)&255,i.data[4*g+3]=255*t.getAt(g)&255;return o.putImageData(i,0,0),e},this.toFileData=function(){var r=this.toCanvas(),a=r.toDataURL();return a.replace("data:image/png;base64,","")}},Minerva.blend=function(r,a,n,t,e,o){null==t&&(t=1),null==n&&(n="normal"),null==o&&(o="clip"),n=n.toLowerCase(),o=o.toLowerCase();var i=Minerva.colormodes.normal,g=Minerva.alphamodes.clip;hasOwnProperty.call(Minerva.colormodes,n)&&(i=Minerva.colormodes[n]),hasOwnProperty.call(Minerva.alphamodes,o)&&(g=Minerva.alphamodes[o]);var h="none",v="none",c="none";if(r instanceof Minerva.image)h="image";else{if("number"!=typeof r)return;h="number"}if(a instanceof Minerva.image)v="image",null==e&&(e=a.getChannel("a"),c="channel");else{if("number"!=typeof a)return;v="number"}if(e instanceof Minerva.channel&&(c="channel"),"number"==h&&"number"==v)return i(Minerva.convert.hex2rgb(r),Minerva.convert.hex2rgb(a));if("image"==h&&"number"==v){var b=new Minerva.image;b.setSize(r.width,r.height);for(var M=0;M<r.width*r.height;M++){var u=i(r.getColorAt(M),Minerva.convert.hex2rgb(a)),s=g(r.getAlphaAt(M),1),l=1;"channel"==c?l=e.getAt(M)*t:"none"==c&&(l=t),b.setColorAt(M,{r:l*u.r+(1-l)*r.getColorAt(M).r,g:l*u.g+(1-l)*r.getColorAt(M).g,b:l*u.b+(1-l)*r.getColorAt(M).b}),b.setColorAt(M,l*r.getColorAt(M)+(1-l)*u),b.setAlphaAt(M,s.a)}return b}if("number"==h&&"image"==v){var b=new Minerva.image;b.setSize(r.width,r.height);for(var M=0;M<r.width*r.height;M++){var u=i(Minerva.convert.hex2rgb(r),a.getColorAt(M)),s=g(1,a.getAlphaAt(M)),l=1;"channel"==c?l=e.getAt(M)*t:"none"==c&&(l=t),b.setColorAt(M,{r:l*u.r+(1-l)*Minerva.convert.hex2rgb(r).r,g:l*u.g+(1-l)*Minerva.convert.hex2rgb(r).g,b:l*u.b+(1-l)*Minerva.convert.hex2rgb(r).b}),b.setAlphaAt(M,s.a)}return b}if("image"==h&&"image"==h&&r.width==a.width&&r.height==a.height){var b=new Minerva.image;b.setSize(r.width,r.height);for(var M=0;M<r.width*r.height;M++){var u=i(r.getColorAt(M),a.getColorAt(M)),s=g(r.getAlphaAt(M),a.getAlphaAt(M)),l=1;"channel"==c?l=e.getAt(M)*t:"none"==c&&(l=t),b.setColorAt(M,{r:l*u.r+(1-l)*r.getColorAt(M).r,g:l*u.g+(1-l)*r.getColorAt(M).g,b:l*u.b+(1-l)*r.getColorAt(M).b}),b.setAlphaAt(M,s.a)}return b}},Minerva.convert.hex2rgb=function(r){var a=r>>16&255,n=r>>8&255,t=255&r;return{r:a/255,g:n/255,b:t/255}},Minerva.convert.rgb2cmyk=function(r){var a=Math.min(1-r.r,1-r.g,1-r.b);return{c:1==a?0:(1-r.r-a)/(1-a),m:1==a?0:(1-r.g-a)/(1-a),y:1==a?0:(1-r.b-a)/(1-a),k:a}},Minerva.convert.cmyk2rgb=function(r){return{r:1-Math.min(1,r.c*(1-r.k)+r.k),g:1-Math.min(1,r.m*(1-r.k)+r.k),b:1-Math.min(1,r.y*(1-r.k)+r.k)}},Minerva.convert.rgb2hsv=function(r){var a=Math.min(r.r,r.g,r.b),n=Math.max(r.r,r.g,r.b),t=n-a,e=0,o=0,i=n;if(0!=t){o=t/n;var g=((n-r.r)/6+t/2)/t,h=((n-r.g)/6+t/2)/t,v=((n-r.b)/6+t/2)/t;r.r==n?e=v-h:r.g==n?e=1/3+g-v:r.b==n&&(e=2/3+h-g),0>e&&(e+=1),e>1&&(e-=1)}return{h:e,s:o,v:i}},Minerva.convert.hsv2rgb=function(r){return 0==r.s?{r:r.v,g:r.v,b:r.v}:(var_h=6*r.h,var_i=Math.floor(var_h),var_1=r.v*(1-r.s),var_2=r.v*(1-r.s*(var_h-var_i)),var_3=r.v*(1-r.s*(1-(var_h-var_i))),0==var_i?(var_r=r.v,var_g=var_3,var_b=var_1):1==var_i?(var_r=var_2,var_g=r.v,var_b=var_1):2==var_i?(var_r=var_1,var_g=r.v,var_b=var_3):3==var_i?(var_r=var_1,var_g=var_2,var_b=r.v):4==var_i?(var_r=var_3,var_g=var_1,var_b=r.v):(var_r=r.v,var_g=var_1,var_b=var_2),{r:var_r,g:var_g,b:var_b})},Minerva.convert.hsy2rgb=function(r){var a=0,n=0,t=0,e=0;return r.h>=0&&r.h<1/6?(e=r.s*r.h/(1/6),t=r.y-Minerva.settings.lumaR*r.s-Minerva.settings.lumaG*e,a=t+r.s,n=t+e):r.h>=1/6&&r.h<2/6?(e=r.s*(r.h-1/6)/(1/6),n=r.y+Minerva.settings.lumaB*r.s+Minerva.settings.lumaR*e,t=n-r.s,a=n-e):r.h>=2/6&&r.h<.5?(e=r.s*(r.h-2/6)/(1/6),a=r.y-Minerva.settings.lumaG*r.s-Minerva.settings.lumaB*e,n=a+r.s,t=a+e):r.h>=.5&&r.h<4/6?(e=r.s*(r.h-.5)/(1/6),t=r.y+Minerva.settings.lumaR*r.s+Minerva.settings.lumaG*e,a=t-r.s,n=t-e):r.h>=4/6&&r.h<5/6?(e=r.s*(r.h-4/6)/(1/6),n=r.y-Minerva.settings.lumaB*r.s-Minerva.settings.lumaR*e,t=n+r.s,a=n+r.k):(e=r.s*(r.h-5/6)/(1/6),a=r.y+Minerva.settings.lumaG*r.s+Minerva.settings.lumaB*e,n=a-r.s,t=a-r.k),{r:a,g:n,b:t}},Minerva.convert.rgb2hsy=function(a){var n=0,t=0,e=a.r*Minerva.settings.lumaR+a.g*Minerva.settings.lumaG+a.b*Minerva.settings.lumaB;return a.r==a.g&&a.g==a.b||(r>=g&&g>=b?(t=a.r-a.b,n=1/6*(a.g-a.b)/t):a.g>a.r&&a.r>=a.b?(t=a.g-a.b,n=1/6*(a.g-a.r)/t+1/6):a.g>=a.b&&a.b>a.r?(t=a.g-a.r,n=1/6*(a.b-a.r)/t+2/6):a.b>a.g&&a.g>a.r?(t=a.b-a.r,n=1/6*(a.b-a.g)/t+.5):a.b>a.r&&a.r>=a.g?(t=a.b-a.g,n=1/6*(a.r-a.g)/t+4/6):(t=a.r-a.g,n=1/6*(a.r-a.b)/t+5/6)),{h:n,s:Math.min(Math.max(t,0),1),y:Math.min(Math.max(e,0),1)}},Minerva.convert.rgb2xyz=function(r){var a=r.r,n=r.g,t=r.b;a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92;var e=.4124*a+.3576*n+.1805*t,o=.2126*a+.7152*n+.0722*t,i=.0193*a+.1192*n+.9505*t;return{x:e,y:o,z:i}},Minerva.convert.rgb2lab=function(r){var a=Minerva.convert.rgb2xyz(r),n=a.x/.95047,t=a.y/1,e=a.z/1.08883;n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116;var o=116*t-16,i=500*(n-t),g=200*(t-e);return{l:o,a:i,b:g}},Minerva.convert.lab2xyz=function(r){var a,n,t,e,o=r.l,i=r.a,g=r.b;return 8>=o?(n=100*o/903.3,e=7.787*(n/100)+16/116):(n=100*Math.pow((o+16)/116,3),e=Math.pow(n/100,1/3)),a=.008856>=a/95.047?a=95.047*(i/500+e-16/116)/7.787:95.047*Math.pow(i/500+e,3),t=.008859>=t/108.883?t=108.883*(e-g/200-16/116)/7.787:108.883*Math.pow(e-g/200,3),{x:a/100,y:n/100,z:t/100}},Minerva.convert.xyz2rgb=function(r){var a,n,t,e=r.x,o=r.y,i=r.z;return a=3.2406*e+-1.5372*o+i*-.4986,n=e*-.9689+1.8758*o+.0415*i,t=.0557*e+o*-.204+1.057*i,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,a=Math.min(Math.max(0,a),1),n=Math.min(Math.max(0,n),1),t=Math.min(Math.max(0,t),1),{r:a,g:n,b:t}},Minerva.convert.lab2rgb=function(r){return Minerva.convert.xyz2rgb(Minerva.convert.lab2xyz(r))},Minerva.convert.rgb2lch=function(r){return Minerva.convert.lab2lch(Minerva.convert.rgb2lab(r))},Minerva.convert.lch2rgb=function(r){return Minerva.convert.lab2rgb(Minerva.convert.lch2lab(r))},Minerva.convert.lab2lch=function(r){var a,n,t,e=r.l,o=r.a,i=r.b;return a=Math.atan2(i,o),n=360*a/2/Math.PI,0>n&&(n+=360),t=Math.sqrt(o*o+i*i),{l:e,c:t,h:n}},Minerva.convert.lch2lab=function(r){var a=r.h/360*2*Math.PI,n=r.c*Math.cos(a),t=r.c*Math.sin(a);return{l:r.l,a:n,b:t}},Minerva.preloader=new function(){var r=[],a={};this.add=function(a){if(Array.isArray(a))for(var n=0;n<a.length;n++)r.push(a[n]);else r.push(a)},this.getImages=function(){return a},this.onComplete=function(n){for(var t=0,e=function(){t++,t==r.length&&n()},o=0;o<r.length;o++){var i=new Image;i.addEventListener("load",e),i.src=r[o],a[r[o]]=i}}},Minerva.colormodes.normal=function(r,a){return{r:a.r,g:a.g,b:a.b}},Minerva.colormodes.ignore=function(r){return{r:r.r,g:r.g,b:r.b}},Minerva.colormodes.average=function(r,a){return{r:(r.r+a.r)/2,g:(r.g+a.g)/2,b:(r.b+a.b)/2}},Minerva.colormodes.stamp=function(r,a){return{r:r.r+2*a.r-1,g:r.g+2*a.g-1,b:r.b+2*a.b-1}},Minerva.colormodes.punch=function(r,a){return{r:a.r+2*r.r-1,g:a.g+2*r.g-1,b:a.b+2*r.b-1}},Minerva.colormodes.darken=function(r,a){return{r:Math.min(r.r,a.r),g:Math.min(r.g,a.g),b:Math.min(r.b,a.b)}},Minerva.colormodes.multiply=function(r,a){return{r:r.r*a.r,g:r.g*a.g,b:r.b*a.b}},Minerva.colormodes.colorburn=function(r,a){return{r:0==a.r?0:1-(1-r.r)/a.r,g:0==a.g?0:1-(1-r.g)/a.g,b:0==a.b?0:1-(1-r.b)/a.b}},Minerva.colormodes.linearburn=function(r,a){return{r:r.r+a.r-1,g:r.g+a.g-1,b:r.b+a.b-1}},Minerva.colormodes.softburn=function(r,a){return{r:a.r+r.r<1?1==r.r?1:a.r/2/(1-r.r):0==a.r?0:1-(1-r.r)/2/a.r,g:a.g+r.g<1?1==r.g?1:a.g/2/(1-r.g):0==a.g?0:1-(1-r.g)/2/a.g,b:a.b+r.b<1?1==r.b?1:a.b/2/(1-r.b):0==a.b?0:1-(1-r.b)/2/a.b}},Minerva.colormodes.lighten=function(r,a){return{r:Math.max(r.r,a.r),g:Math.max(r.g,a.g),b:Math.max(r.b,a.b)}},Minerva.colormodes.screen=function(r,a){return{r:1-(1-r.r)*(1-a.r),g:1-(1-r.g)*(1-a.g),b:1-(1-r.b)*(1-a.b)}},Minerva.colormodes.lineardodge=function(r,a){return{r:Math.min(1,r.r+a.r),g:Math.min(1,r.g+a.g),b:Math.min(1,r.b+a.b)}},Minerva.colormodes.colordodge=function(r,a){return{r:1==a.r?1:r.r/(1-a.r),g:1==a.g?1:r.g/(1-a.g),b:1==a.b?1:r.b/(1-a.b)}},Minerva.colormodes.softdodge=function(r,a){return{r:r.r+a.r<=1?1==a.r?1:r.r/2/(1-a.r):1-(1-a.r)/2/r.r,g:r.g+a.g<=1?1==a.g?1:r.g/2/(1-a.g):1-(1-a.g)/2/r.g,b:r.b+a.b<=1?1==a.b?1:r.b/2/(1-a.b):1-(1-a.b)/2/r.b}},Minerva.colormodes.difference=function(r,a){return{r:Math.abs(r.r-a.r),g:Math.abs(r.g-a.g),b:Math.abs(r.b-a.b)}},Minerva.colormodes.negation=function(r,a){return{r:1-Math.abs(1-r.r-a.r),g:1-Math.abs(1-r.g-a.g),b:1-Math.abs(1-r.b-a.b)}},Minerva.colormodes.exclusion=function(r,a){return{r:r.r+a.r-2*r.r*a.r,g:r.g+a.g-2*r.g*a.g,b:r.b+a.b-2*r.b*a.b}},Minerva.colormodes.divide=function(r,a){return{r:0==a.r?0:r.r/a.r,g:0==a.g?0:r.g/a.g,b:0==a.b?0:r.b/a.b}},Minerva.colormodes.subtract=function(r,a){return{r:Math.max(0,Math.min(1,r.r-a.r)),g:Math.max(0,Math.min(1,r.g-a.g)),b:Math.max(0,Math.min(1,r.b-a.b))}},Minerva.colormodes.phoenix=function(r,a){return{r:Math.min(r.r,a.r)-Math.max(r.r,a.r)+1,g:Math.min(r.g,a.g)-Math.max(r.g,a.g)+1,b:Math.min(r.b,a.b)-Math.max(r.b,a.b)+1}},Minerva.colormodes.inversesubtract=function(r,a){return{r:a.r-(1-r.r),g:a.g-(1-r.g),b:a.b-(1-r.b)}},Minerva.colormodes.arctangent=function(r,a){return{r:0==r.r?0==a.r?0:1:2*Math.atan(r.r/a.r)/Math.PI,g:0==r.g?0==a.g?0:1:2*Math.atan(r.g/a.g)/Math.PI,b:0==r.b?0==a.b?0:1:2*Math.atan(r.b/a.b)/Math.PI}},Minerva.colormodes.parallel=function(r,a){return{r:0==r.r?1:0==a.r?1:2/(1/r.r+1/a.r),g:0==r.g?1:0==a.g?1:2/(1/r.g+1/a.g),b:0==r.b?1:0==a.b?1:2/(1/r.b+1/a.b)}},Minerva.colormodes.equivalence=function(r,a){return{r:1-Math.abs(r.r-a.r),g:1-Math.abs(r.g-a.g),b:1-Math.abs(r.b-a.b)}},Minerva.colormodes.grainmerge=function(r,a){return{r:r.r+a.r-.5,g:r.g+a.g-.5,b:r.b+a.b-.5}},Minerva.colormodes.grainextract=function(r,a){return{r:r.r-a.r+.5,g:r.g-a.g+.5,b:r.b-a.b+.5}},Minerva.colormodes.addsubtract=function(r,a){return{r:Math.abs(Math.sqrt(r.r)-Math.sqrt(a.r)),g:Math.abs(Math.sqrt(r.g)-Math.sqrt(a.g)),b:Math.abs(Math.sqrt(r.b)-Math.sqrt(a.b))}},Minerva.colormodes.gammadark=function(r,a){return{r:0==a.r?0:Math.pow(r.r,1/a.r),g:0==a.g?0:Math.pow(r.g,1/a.g),b:0==a.b?0:Math.pow(r.b,1/a.b)}},Minerva.colormodes.gammalight=function(r,a){return{r:0==r.r?0:Math.pow(a.r,1/r.r),g:0==r.g?0:Math.pow(a.g,1/r.g),b:0==r.b?0:Math.pow(a.b,1/r.b)}},Minerva.colormodes.geometricmean=function(r,a){return{r:Math.sqrt(r.r*a.r),g:Math.sqrt(r.g*a.g),b:Math.sqrt(r.b*a.b)}},Minerva.colormodes.softlightsvg=function(r,a){return{r:r.r>.5?a.r+(2*r.r-1)*((a.r>.25?Math.sqrt(a.r):(16*a.r-12)*a.r+4)-a.r):a.r-(1-2*r.r)*a.r*(1-a.r),g:r.g>.5?a.g+(2*r.g-1)*((a.g>.25?Math.sqrt(a.g):(16*a.g-12)*a.g+4)-a.g):a.g-(1-2*r.g)*a.g*(1-a.g),b:r.b>.5?a.b+(2*r.b-1)*((a.b>.25?Math.sqrt(a.b):(16*a.b-12)*a.b+4)-a.b):a.b-(1-2*r.b)*a.b*(1-a.b)}},Minerva.colormodes.overlay=function(r,a){return{r:r.r>.5?1-2*(1-a.r)*(1-r.r):2*a.r*r.r,g:r.g>.5?1-2*(1-a.g)*(1-r.g):2*a.g*r.g,b:r.b>.5?1-2*(1-a.b)*(1-r.b):2*a.b*r.b}},Minerva.colormodes.softlight=function(r,a){return{r:a.r<.5?(1-2*a.r)*r.r*r.r+2*a.r*r.r:(1-(2*a.r-1))*r.r+(2*a.r-1)*Math.sqrt(r.r),g:a.g<.5?(1-2*a.g)*r.g*r.g+2*a.g*r.g:(1-(2*a.g-1))*r.g+(2*a.g-1)*Math.sqrt(r.g),b:a.b<.5?(1-2*a.b)*r.b*r.b+2*a.b*r.b:(1-(2*a.b-1))*r.b+(2*a.b-1)*Math.sqrt(r.b)}},Minerva.colormodes.peglight=function(r,a){return{r:(1-r.r)*r.r*a.r+r.r*(1-(1-r.r)*(1-a.r)),g:(1-r.g)*r.g*a.g+r.g*(1-(1-r.g)*(1-a.g)),b:(1-r.b)*r.b*a.b+r.b*(1-(1-r.b)*(1-a.b))}},Minerva.colormodes.hardlight=function(r,a){return{r:a.r>.5?1-2*(1-r.r)*(1-a.r):2*r.r*a.r,g:a.g>.5?1-2*(1-r.g)*(1-a.g):2*r.g*a.g,b:a.b>.5?1-2*(1-r.b)*(1-a.b):2*r.b*a.b}},Minerva.colormodes.linearlight=function(r,a){return{r:a.r>.5?r.r+2*(a.r-.5):r.r+2*a.r-1,g:a.g>.5?r.g+2*(a.g-.5):r.g+2*a.g-1,b:a.b>.5?r.b+2*(a.b-.5):r.b+2*a.b-1}},Minerva.colormodes.vividlight=function(r,a){return{r:a.r<.5?2*a.r==0?0:1-(1-r.r)/(2*a.r):2*(a.r-.5)==1?1:r.r/(1-2*(a.r-.5)),g:a.g<.5?2*a.g==0?0:1-(1-r.g)/(2*a.g):2*(a.g-.5)==1?1:r.g/(1-2*(a.g-.5)),b:a.b<.5?2*a.b==0?0:1-(1-r.b)/(2*a.b):2*(a.b-.5)==1?1:r.b/(1-2*(a.b-.5))}},Minerva.colormodes.pinlight=function(r,a){return{r:a.r<2*r.r-1?2*r.r-1:2*r.r-1<a.r&&a.r<2*r.r?a.r:2*r.r,g:a.g<2*r.g-1?2*r.g-1:2*r.g-1<a.g&&a.g<2*r.g?a.g:2*r.g,b:a.b<2*r.b-1?2*r.b-1:2*r.b-1<a.b&&a.b<2*r.b?a.b:2*r.b}},Minerva.colormodes.reflect=function(r,a){return{r:1==a.r?1:r.r*r.r/(1-a.r)>1?1:r.r*r.r/(1-a.r),g:1==a.g?1:r.g*r.g/(1-a.g)>1?1:r.g*r.g/(1-a.g),b:1==a.b?1:r.b*r.b/(1-a.b)>1?1:r.b*r.b/(1-a.b)}},Minerva.colormodes.glow=function(r,a){return{r:1==r.r?1:a.r*a.r/(1-r.r)>1?1:a.r*a.r/(1-r.r),g:1==r.g?1:a.g*a.g/(1-r.g)>1?1:a.g*a.g/(1-r.g),b:1==r.b?1:a.b*a.b/(1-r.b)>1?1:a.b*a.b/(1-r.b)}},Minerva.colormodes.freeze=function(r,a){return{r:0==a.r?0:1-(1-r.r)*(1-r.r)/a.r,g:0==a.g?0:1-(1-r.g)*(1-r.g)/a.g,b:0==a.b?0:1-(1-r.b)*(1-r.b)/a.b}},Minerva.colormodes.heat=function(r,a){return{r:0==r.r?0:1-(1-a.r)*(1-a.r)/r.r,g:0==r.g?0:1-(1-a.g)*(1-a.g)/r.g,b:0==r.b?0:1-(1-a.b)*(1-a.b)/r.b}},Minerva.colormodes.interpolation=function(r,a){return{r:.5-.25*Math.cos(Math.PI*r.r)-.25*Math.cos(Math.PI*a.r),g:.5-.25*Math.cos(Math.PI*r.g)-.25*Math.cos(Math.PI*a.g),b:.5-.25*Math.cos(Math.PI*r.b)-.25*Math.cos(Math.PI*a.b)}},Minerva.colormodes.hardmix=function(r,a){return{r:r.r<1-a.r?0:1,g:r.g<1-a.g?0:1,b:r.b<1-a.b?0:1}},Minerva.colormodes.binaryand=function(r,a){return{r:(255&Math.round(255*r.r)&(255&Math.round(255*a.r)))/255,g:(255&Math.round(255*r.g)&(255&Math.round(255*a.g)))/255,b:(255&Math.round(255*r.b)&(255&Math.round(255*a.b)))/255}},Minerva.colormodes.binaryor=function(r,a){return{r:(255&Math.round(255*r.r)|255&Math.round(255*a.r))/255,g:(255&Math.round(255*r.g)|255&Math.round(255*a.g))/255,b:(255&Math.round(255*r.b)|255&Math.round(255*a.b))/255}},Minerva.colormodes.binaryxor=function(r,a){return{r:(255&Math.round(255*r.r)^255&Math.round(255*a.r))/255,g:(255&Math.round(255*r.g)^255&Math.round(255*a.g))/255,b:(255&Math.round(255*r.b)^255&Math.round(255*a.b))/255}},Minerva.colormodes.binarynand=function(r,a){return{r:(255&Math.round(255*r.r)&~(255&Math.round(255*a.r)))/255,g:(255&Math.round(255*r.g)&~(255&Math.round(255*a.g)))/255,b:(255&Math.round(255*r.b)&~(255&Math.round(255*a.b)))/255}},Minerva.colormodes.rgbRed=function(r,a){return{r:a.r,g:r.g,b:r.b}},Minerva.colormodes.rgbGreen=function(r,a){return{r:r.r,g:a.g,b:r.b}},Minerva.colormodes.rgbBlue=function(r,a){return{r:r.r,g:r.g,b:a.b}},Minerva.colormodes.cmykcyan=function(r,a){var n=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(a);return Minerva.convert.cmyk2rgb({c:t.c,m:n.m,y:n.y,k:n.k})},Minerva.colormodes.cmykmagenta=function(r,a){var n=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(a);return Minerva.convert.cmyk2rgb({c:n.c,m:t.m,y:n.y,k:n.k})},Minerva.colormodes.cmykyellow=function(r,a){var n=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(a);return Minerva.convert.cmyk2rgb({c:n.c,m:n.m,y:t.y,k:n.k})},Minerva.colormodes.cmykkey=function(r,a){var n=Minerva.convert.rgb2cmyk(r),t=Minerva.convert.rgb2cmyk(a);return Minerva.convert.cmyk2rgb({c:n.c,m:n.m,y:n.y,k:t.k})},Minerva.colormodes.hsvhue=function(r,a){var n=Minerva.convert.rgb2hsv(r),t=Minerva.convert.rgb2hsv(a);return Minerva.convert.hsv2rgb({h:t.h,s:n.s,v:n.v})},Minerva.colormodes.hsvsaturation=function(r,a){var n=Minerva.convert.rgb2hsv(r),t=Minerva.convert.rgb2hsv(a);return Minerva.convert.hsv2rgb({h:n.h,s:t.s,v:n.v})},Minerva.colormodes.hsvvalue=function(r,a){var n=Minerva.convert.rgb2hsv(r),t=Minerva.convert.rgb2hsv(a);return Minerva.convert.hsv2rgb({h:n.h,s:n.s,v:t.v})},Minerva.colormodes.hsyhue=function(r,a){var n=Minerva.convert.rgb2hsy(r),t=Minerva.convert.rgb2hsy(a);return Minerva.convert.hsy2rgb({h:t.h,s:n.s,y:n.y})},Minerva.colormodes.hsysaturation=function(r,a){var n=Minerva.convert.rgb2hsy(r),t=Minerva.convert.rgb2hsy(a);return Minerva.convert.hsy2rgb({h:n.h,s:t.s,y:n.y})},Minerva.colormodes.hsyluminance=function(r,a){var n=Minerva.convert.rgb2hsy(r),t=Minerva.convert.rgb2hsy(a);return Minerva.convert.hsy2rgb({h:n.h,s:n.s,y:t.y})},Minerva.colormodes.labluminance=function(r,a){var n=Minerva.convert.rgb2lab(r),t=Minerva.convert.rgb2lab(a);return Minerva.convert.lab2rgb({l:t.l,a:n.a,b:n.b})},Minerva.colormodes.labalpha=function(r,a){var n=Minerva.convert.rgb2lab(r),t=Minerva.convert.rgb2lab(a);return Minerva.convert.lab2rgb({l:n.l,a:t.a,b:n.b})},Minerva.colormodes.labbeta=function(r,a){var n=Minerva.convert.rgb2lab(r),t=Minerva.convert.rgb2lab(a);return Minerva.convert.lab2rgb({l:n.l,a:n.a,b:t.b})},Minerva.colormodes.lchluminance=function(r,a){var n=Minerva.convert.rgb2lch(r),t=Minerva.convert.rgb2lch(a);return Minerva.convert.lch2rgb({l:t.l,c:n.c,h:n.h})},Minerva.colormodes.lchchroma=function(r,a){var n=Minerva.convert.rgb2lch(r),t=Minerva.convert.rgb2lch(a);return Minerva.convert.lch2rgb({l:n.l,c:t.c,h:n.h})},Minerva.colormodes.lchhue=function(r,a){var n=Minerva.convert.rgb2lch(r),t=Minerva.convert.rgb2lch(a);return Minerva.convert.lch2rgb({l:n.l,c:n.c,h:t.h})},Minerva.alphamodes.discard=function(){return{a:1}},Minerva.alphamodes.replace=function(r,a){return{a:a.a}},Minerva.alphamodes.clip=function(r){return{a:r.a}},Minerva.alphamodes.average=function(r,a){return{a:(r.a+a.a)/2}},Minerva.alphamodes.stamp=function(r,a){return{a:r.a+2*a.a-1}},Minerva.alphamodes.punch=function(r,a){return{a:a.a+2*r.a-1}},Minerva.alphamodes.darken=function(r,a){return{a:Math.min(r.a,a.a)}},Minerva.alphamodes.multiply=function(r,a){return{a:r.a*a.a}},Minerva.alphamodes.colorburn=function(r,a){return{a:0==a.a?0:1-(1-r.a)/a.a}},Minerva.alphamodes.linearburn=function(r,a){return{a:r.a+a.a-1}},Minerva.alphamodes.softburn=function(r,a){return{a:a.a+r.a<1?1==r.a?1:a.a/2/(1-r.a):0==a.a?0:1-(1-r.a)/2/a.a}},Minerva.alphamodes.lighten=function(r,a){return{a:Math.max(r.a,a.a)}},Minerva.alphamodes.screen=function(r,a){return{a:1-(1-r.a)*(1-a.a)}},Minerva.alphamodes.lineardodge=function(r,a){return{a:Math.min(1,r.a+a.a)}},Minerva.alphamodes.colordodge=function(r,a){return{a:1==a.a?1:r.a/(1-a.a)}},Minerva.alphamodes.softdodge=function(r,a){return{a:r.a+a.a<=1?1==a.a?1:r.a/2/(1-a.a):1-(1-a.a)/2/r.a}},Minerva.alphamodes.difference=function(r,a){return{a:Math.abs(r.a-a.a)}},Minerva.alphamodes.negation=function(r,a){return{a:1-Math.abs(1-r.a-a.a)}},Minerva.alphamodes.exclusion=function(r,a){return{a:r.a+a.a-2*r.a*a.a}},Minerva.alphamodes.divide=function(r,a){return{a:0==a.a?0:r.a/a.a}},Minerva.alphamodes.subtract=function(r,a){return{a:Math.max(0,Math.min(1,r.a-a.a))}},Minerva.alphamodes.phoenix=function(r,a){return{a:Math.min(r.a,a.a)-Math.max(r.a,a.a)+1}},Minerva.alphamodes.inversesubtract=function(r,a){return{a:a.a-(1-r.a)}},Minerva.alphamodes.arctangent=function(r,a){return{a:0==r.a?0==a.a?0:1:2*Math.atan(r.a/a.a)/Math.PI}},Minerva.alphamodes.parallel=function(r,a){return{a:0==r.a?1:0==a.a?1:2/(1/r.a+1/a.a)}},Minerva.alphamodes.equivalence=function(r,a){return{a:1-Math.abs(r.a-a.a)}},Minerva.alphamodes.grainmerge=function(r,a){return{a:r.a+a.a-.5}},Minerva.alphamodes.grainextract=function(r,a){return{a:r.a-a.a+.5}},Minerva.alphamodes.addsubtract=function(r,a){return{a:Math.abs(Math.sqrt(r.a)-Math.sqrt(a.a))}},Minerva.alphamodes.gammadark=function(r,a){return{a:0==a.a?0:Math.pow(r.a,1/a.a)}},Minerva.alphamodes.gammalight=function(r,a){return{a:0==r.a?0:Math.pow(a.a,1/r.a)}},Minerva.alphamodes.geometricmean=function(r,a){return{a:Math.sqrt(r.a*a.a)}},Minerva.alphamodes.softlightsvg=function(r,a){return{a:r.a>.5?a.a+(2*r.a-1)*((a.a>.25?Math.sqrt(a.a):(16*a.a-12)*a.a+4)-a.a):a.a-(1-2*r.a)*a.a*(1-a.a)}},Minerva.alphamodes.overlay=function(r,a){return{a:r.a>.5?1-2*(1-a.a)*(1-r.a):2*a.a*r.a}},Minerva.alphamodes.softlight=function(r,a){return{a:a.a<.5?(1-2*a.a)*r.a*r.a+2*a.a*r.a:(1-(2*a.a-1))*r.a+(2*a.a-1)*Math.sqrt(r.a)}},Minerva.alphamodes.peglight=function(r,a){return{a:(1-r.a)*r.a*a.a+r.a*(1-(1-r.a)*(1-a.a))}},Minerva.alphamodes.hardlight=function(r,a){return{a:a.a>.5?1-2*(1-r.a)*(1-a.a):2*r.a*a.a}},Minerva.alphamodes.linearlight=function(r,a){return{a:a.a>.5?r.a+2*(a.a-.5):r.a+2*a.a-1}},Minerva.alphamodes.vividlight=function(r,a){return{a:a.a<.5?2*a.a==0?0:1-(1-r.a)/(2*a.a):2*(a.a-.5)==1?1:r.a/(1-2*(a.a-.5))}},Minerva.alphamodes.pinlight=function(r,a){return{a:a.a<2*r.a-1?2*r.a-1:2*r.a-1<a.a&&a.a<2*r.a?a.a:2*r.a}},Minerva.alphamodes.reflect=function(r,a){return{a:1==a.a?1:r.a*r.a/(1-a.a)>1?1:r.a*r.a/(1-a.a)}},Minerva.alphamodes.glow=function(r,a){return{a:1==r.a?1:a.a*a.a/(1-r.a)>1?1:a.a*a.a/(1-r.a)}},Minerva.alphamodes.freeze=function(r,a){return{a:0==a.a?0:1-(1-r.a)*(1-r.a)/a.a}},Minerva.alphamodes.heat=function(r,a){return{a:0==r.a?0:1-(1-a.a)*(1-a.a)/r.a}},Minerva.alphamodes.interpolation=function(r,a){return{a:.5-.25*Math.cos(Math.PI*r.a)-.25*Math.cos(Math.PI*a.a)}},Minerva.alphamodes.hardmix=function(r,a){return{a:r.a<1-a.a?0:1}},Minerva.alphamodes.binaryand=function(r,a){return{a:(255&Math.round(255*r.a)&(255&Math.round(255*a.a)))/255}},Minerva.alphamodes.binaryor=function(r,a){return{a:(255&Math.round(255*r.a)|255&Math.round(255*a.a))/255}},Minerva.alphamodes.binaryxor=function(r,a){return{a:(255&Math.round(255*r.a)^255&Math.round(255*a.a))/255}},Minerva.alphamodes.binarynand=function(r,a){return{a:(255&Math.round(255*r.a)&~(255&Math.round(255*a.a)))/255}};
