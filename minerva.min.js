var Minerva=new function(){var t=[],n={};this.Utility={},this.Utility.getAverageTotal=function(t){if(t instanceof Minerva.Img){var r=0,n=0,a=0;for(i=0;i<t.width*t.height;i++){var e=t.getColorAt(i);r+=e.r,n+=e.g,a+=e.b}return{r:r/(t.width*t.height),g:n/(t.width*t.height),b:a/(t.width*t.height)}}},this.Utility.getAverageVisible=function(t){if(t instanceof Minerva.Img){var r=0,n=0,a=0,e=0;for(i=0;i<t.width*t.height;i++){var h=t.getColorAt(i),g=t.getAlphaAt(i);r+=h.r*g,n+=h.g*g,a+=h.b*g,e+=g.a}return{r:r/(t.width*t.height)/e,g:n/(t.width*t.height)/e,b:a/(t.width*t.height)/e}}},this.preload=function(r){if("string"==typeof r)t.push(r);else if(Array.isArray(r))for(var n=0;n<r.length;n++)t.push(r[n])},this.getPreloadedImages=function(){return n},this.onPreloaded=function(r){for(var a=0,e=function(){a++,a==t.length&&r()},h=0;h<t.length;h++){var i=new Image;i.addEventListener("load",e),i.src=t[h],n[t[h]]=i}},this.Channel=function(){var t=[];this.width=0,this.height=0,this.add=function(r){t.push(r)},this.set=function(r){r instanceof Minerva.Channel&&(t=r.get())},this.setAt=function(r,n){t[r]=n},this.get=function(){return t},this.getAt=function(r){return t[r]},this.setSize=function(t,r){this.width=t,this.height=r}},this.Img=function(t){this.getChannel=function(t){return"r"==t?r:"g"==t?n:"b"==t?a:"a"==t?e:void 0},this.setChannel=function(t,h){"r"==t?r=h:"g"==t?n=h:"b"==t?a=h:"a"==t&&(e=h)},this.setSize=function(t,h){this.width=t,this.height=h,r.setSize(t,h),n.setSize(t,h),a.setSize(t,h),e.setSize(t,h)},this.getColorAt=function(t){return{r:r.getAt(t),g:n.getAt(t),b:a.getAt(t)}},this.getAlphaAt=function(t){return e.getAt(t)},this.setColorAt=function(t,e){r.setAt(t,Math.min(1,Math.max(0,e.r))),n.setAt(t,Math.min(1,Math.max(0,e.g))),a.setAt(t,Math.min(1,Math.max(0,e.b)))},this.setAlphaAt=function(t,r){e.setAt(t,Math.min(1,Math.max(0,r)))},this.fromImage=function(t){this.width=t.width,this.height=t.height,r.setSize(t.width,t.height),n.setSize(t.width,t.height),a.setSize(t.width,t.height),e.setSize(t.width,t.height);var h=document.createElement("canvas");h.width=this.width,h.height=this.height;var i=h.getContext("2d");i.drawImage(t,0,0);for(var g=i.getImageData(0,0,this.width,this.height),u=0;u<g.data.length/4;u++)r.add(g.data[4*u+0]/255),n.add(g.data[4*u+1]/255),a.add(g.data[4*u+2]/255),e.add(g.data[4*u+3]/255)},this.fromUrl=function(t){var r=new Image;r.src=t,this.fromImage(r)},this.toCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;for(var h=t.getContext("2d"),i=h.createImageData(this.width,this.height),g=0;g<i.data.length/4;g++)i.data[4*g+0]=255*r.getAt(g)&255,i.data[4*g+1]=255*n.getAt(g)&255,i.data[4*g+2]=255*a.getAt(g)&255,i.data[4*g+3]=255*e.getAt(g)&255;return h.putImageData(i,0,0),t},this.toFileData=function(){var t=this.toCanvas(),r=t.toDataURL();return r.replace("data:image/png;baseData64,","")},this.width=0,this.height=0;var r=new Minerva.Channel,n=new Minerva.Channel,a=new Minerva.Channel,e=new Minerva.Channel;null==t||("string"==typeof t?this.fromUrl(t):t instanceof Image&&this.fromImage(t))};var a={lumaR:.3,lumaG:.59,lumaB:.11},e={hex2rgb:function(t){var r=t>>16&255,n=t>>8&255,a=255&t;return{r:r/255,g:n/255,b:a/255}},rgb2hsl:function(t){var r,n,a,e=t[0]/255,h=t[1]/255,i=t[2]/255,g=Math.min(e,h,i),u=Math.max(e,h,i),b=u-g;return u==g?r=0:e==u?r=(h-i)/b:h==u?r=2+(i-e)/b:i==u&&(r=4+(e-h)/b),r=Math.min(60*r,360),0>r&&(r+=360),a=(g+u)/2,n=u==g?0:.5>=a?b/(u+g):b/(2-u-g),[r,100*n,100*a]},rgb2hsv:function(t){var r,n,a,e=t[0],h=t[1],i=t[2],g=Math.min(e,h,i),u=Math.max(e,h,i),b=u-g;return n=0==u?0:b/u*1e3/10,u==g?r=0:e==u?r=(h-i)/b:h==u?r=2+(i-e)/b:i==u&&(r=4+(e-h)/b),r=Math.min(60*r,360),0>r&&(r+=360),a=u/255*1e3/10,[r,n,a]},rgb2hwb:function(t){var r=t[0],n=t[1],a=t[2],h=e.rgb2hsl(t)[0],i=1/255*Math.min(r,Math.min(n,a)),a=1-1/255*Math.max(r,Math.max(n,a));return[h,100*i,100*a]},rgb2cmyk:function(t){var r,n,a,e,h=t[0]/255,i=t[1]/255,g=t[2]/255;return e=Math.min(1-h,1-i,1-g),r=(1-h-e)/(1-e)||0,n=(1-i-e)/(1-e)||0,a=(1-g-e)/(1-e)||0,[100*r,100*n,100*a,100*e]},rgb2xyz:function(t){var r=t[0]/255,n=t[1]/255,a=t[2]/255;r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92;var e=.4124*r+.3576*n+.1805*a,h=.2126*r+.7152*n+.0722*a,i=.0193*r+.1192*n+.9505*a;return[100*e,100*h,100*i]},rgb2lab:function(t){var r,n,a,h=e.rgb2xyz(t),i=h[0],g=h[1],u=h[2];return i/=95.047,g/=100,u/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,g=g>.008856?Math.pow(g,1/3):7.787*g+16/116,u=u>.008856?Math.pow(u,1/3):7.787*u+16/116,r=116*g-16,n=500*(i-g),a=200*(g-u),[r,n,a]},rgb2lch:function(t){return e.lab2lch(e.rgb2lab(t))},hsl2rgb:function(t){var r,n,a,e,h,i=t[0]/360,g=t[1]/100,u=t[2]/100;if(0==g)return h=255*u&255,[h,h,h];n=.5>u?u*(1+g):u+g-u*g,r=2*u-n,e=[0,0,0];for(var b=0;3>b;b++)a=i+1/3*-(b-1),0>a&&a++,a>1&&a--,h=1>6*a?r+6*(n-r)*a:1>2*a?n:2>3*a?r+(n-r)*(2/3-a)*6:r,e[b]=255&Math.round(255*h);return e},hsl2hsv:function(t){var r,n,a=t[0],e=t[1]/100,h=t[2]/100;return h*=2,e*=1>=h?h:2-h,n=(h+e)/2,r=2*e/(h+e),[a,100*r,100*n]},hsl2hwb:function(t){return e.rgb2hwb(e.hsl2rgb(t))},hsl2cmyk:function(t){return e.rgb2cmyk(e.hsl2rgb(t))},hsv2rgb:function(t){var r=t[0]/60,n=t[1]/100,a=t[2]/100,e=Math.floor(r)%6,h=r-Math.floor(r),i=255*a*(1-n),g=255*a*(1-n*h),u=255*a*(1-n*(1-h)),a=255*a;switch(e){case 0:return[a,u,i];case 1:return[g,a,i];case 2:return[i,a,u];case 3:return[i,g,a];case 4:return[u,i,a];case 5:return[a,i,g]}},hsv2hsl:function(t){var r,n,a=t[0],e=t[1]/100,h=t[2]/100;return n=(2-e)*h,r=e*h,r/=1>=n?n:2-n,r=r||0,n/=2,[a,100*r,100*n]},hsv2hwb:function(t){return e.rgb2hwb(e.hsv2rgb(t))},hsv2cmyk:function(t){return e.rgb2cmyk(e.hsv2rgb(t))},hwb2rgb:function(t){var n,a,e,h,i=t[0]/360,u=t[1]/100,o=t[2]/100,c=u+o;switch(c>1&&(u/=c,o/=c),n=Math.floor(6*i),a=1-o,e=6*i-n,0!=(1&n)&&(e=1-e),h=u+e*(a-u),n){default:case 6:case 0:r=a,g=h,b=u;break;case 1:r=h,g=a,b=u;break;case 2:r=u,g=a,b=h;break;case 3:r=u,g=h,b=a;break;case 4:r=h,g=u,b=a;break;case 5:r=a,g=u,b=h}return[255&Math.round(255*r),255&Math.round(255*g),255&Math.round(255*b)]},hwb2hsl:function(t){return e.rgb2hsl(e.hwb2rgb(t))},hwb2hsv:function(t){return e.rgb2hsv(e.hwb2rgb(t))},hwb2cmyk:function(t){return e.rgb2cmyk(e.hwb2rgb(t))},cmyk2rgb:function(t){var r,n,a,e=t[0]/100,h=t[1]/100,i=t[2]/100,g=t[3]/100;return r=1-Math.min(1,e*(1-g)+g),n=1-Math.min(1,h*(1-g)+g),a=1-Math.min(1,i*(1-g)+g),[255&Math.round(255*r),255&Math.round(255*n),255&Math.round(255*a)]},cmyk2hsl:function(t){return e.rgb2hsl(e.cmyk2rgb(t))},cmyk2hsv:function(t){return e.rgb2hsv(e.cmyk2rgb(t))},cmyk2hwb:function(t){return e.rgb2hwb(e.cmyk2rgb(t))},xyz2rgb:function(t){var r,n,a,e=t[0]/100,h=t[1]/100,i=t[2]/100;return r=3.2406*e+-1.5372*h+i*-.4986,n=e*-.9689+1.8758*h+.0415*i,a=.0557*e+h*-.204+1.057*i,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=12.92*r,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n=12.92*n,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=12.92*a,r=Math.min(Math.max(0,r),1),n=Math.min(Math.max(0,n),1),a=Math.min(Math.max(0,a),1),[255&Math.round(255*r),255&Math.round(255*n),255&Math.round(255*a)]},xyz2lab:function(t){var r,n,a,e=t[0],h=t[1],i=t[2];return e/=95.047,h/=100,i/=108.883,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,h=h>.008856?Math.pow(h,1/3):7.787*h+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=116*h-16,n=500*(e-h),a=200*(h-i),[r,n,a]},xyz2lch:function(t){return e.lab2lch(e.xyz2lab(t))},lab2xyz:function(t){var r,n,a,e,h=t[0],i=t[1],g=t[2];return 8>=h?(n=100*h/903.3,e=7.787*(n/100)+16/116):(n=100*Math.pow((h+16)/116,3),e=Math.pow(n/100,1/3)),r=.008856>=r/95.047?r=95.047*(i/500+e-16/116)/7.787:95.047*Math.pow(i/500+e,3),a=.008859>=a/108.883?a=108.883*(e-g/200-16/116)/7.787:108.883*Math.pow(e-g/200,3),[r,n,a]},lab2lch:function(t){var r,n,a,e=t[0],h=t[1],i=t[2];return r=Math.atan2(i,h),n=360*r/2/Math.PI,0>n&&(n+=360),a=Math.sqrt(h*h+i*i),[e,a,n]},lab2rgb:function(t){return e.xyz2rgb(e.lab2xyz(t))},lch2lab:function(t){var r,n,a,e=t[0],h=t[1],i=t[2];return a=i/360*2*Math.PI,r=h*Math.cos(a),n=h*Math.sin(a),[e,r,n]},lch2xyz:function(t){return e.lab2xyz(e.lch2lab(t))},lch2rgb:function(t){return e.lab2rgb(e.lch2lab(t))},rgb2hsy:function(t){var r=t[0]/255,n=t[1]/255,e=t[2]/255,h=0,i=0,g=r*a.lumaR+n*a.lumaG+e*a.lumaB;return r==n&&n==e||(r>=n&&n>=e?(i=r-e,h=1/6*(n-e)/i):n>r&&r>=e?(i=n-e,h=1/6*(n-r)/i+1/6):n>=e&&e>r?(i=n-r,h=1/6*(e-r)/i+2/6):e>n&&n>r?(i=e-r,h=1/6*(e-n)/i+.5):e>r&&r>=n?(i=e-n,h=1/6*(r-n)/i+4/6):(i=r-n,h=1/6*(r-e)/i+5/6)),[h,Math.min(Math.max(i,0),1),Math.min(Math.max(g,0),1)]},hsy2rgb:function(t){var r=0,n=0,e=0,h=0,i=t[0],g=t[1],u=t[2];return i>=0&&1/6>i?(h=g*i/(1/6),e=u-a.lumaR*g-a.lumaG*h,r=e+g,n=e+h):i>=1/6&&2/6>i?(h=g*(i-1/6)/(1/6),n=u+a.lumaB*g+a.lumaR*h,e=n-g,r=n-h):i>=2/6&&.5>i?(h=g*(i-2/6)/(1/6),r=u-a.lumaG*g-a.lumaB*h,n=r+g,e=r+h):i>=.5&&4/6>i?(h=g*(i-.5)/(1/6),e=u+a.lumaR*g+a.lumaG*h,r=e-g,n=e-h):i>=4/6&&5/6>i?(h=g*(i-4/6)/(1/6),n=u-a.lumaB*g-a.lumaR*h,e=n+g,r=n+h):(h=g*(i-5/6)/(1/6),r=u+a.lumaG*g+a.lumaB*h,n=r-g,e=r-h),r=Math.max(0,Math.min(1,r)),n=Math.max(0,Math.min(1,n)),e=Math.max(0,Math.min(1,e)),[255&Math.round(255*r),255&Math.round(255*n),255&Math.round(255*e)]}},h={normal:function(t,r){return r},ignore:function(t){return t},clip:function(t){return t},replace:function(t,r){return r},discard:function(){return 1},average:function(t,r){return(t+r)/2},stamp:function(t,r){return t+2*r-1},punch:function(t,r){return r+2*t-1},darken:function(t,r){return Math.min(t,r)},multiply:function(t,r){return t*r},colorburn:function(t,r){return 0==r?0:1-(1-t)/r},linearburn:function(t,r){return t+r-1},softburn:function(t,r){return 1>r+t?1==t?1:r/2/(1-t):0==r?0:1-(1-t)/2/r},lighten:function(t,r){return Math.max(t,r)},screen:function(t,r){return 1-(1-t)*(1-r)},lineardodge:function(t,r){return Math.min(1,t+r)},colordodge:function(t,r){return 1==r?1:t/(1-r)},softdodge:function(t,r){return 1>=t+r?1==r?1:t/2/(1-r):1-(1-r)/2/t},difference:function(t,r){return Math.abs(t-r)},negation:function(t,r){return 1-Math.abs(1-t-r)},exclusion:function(t,r){return t+r-2*t*r},divide:function(t,r){return 0==r?0:t/r},subtract:function(t,r){return Math.max(0,Math.min(1,t-r))},phoenix:function(t,r){return Math.min(t,r)-Math.max(t,r)+1},inversesubtract:function(t,r){return r-(1-t)},arctangent:function(t,r){return 0==t?0==r?0:1:2*Math.atan(r/t)/Math.PI},parallel:function(t,r){return 2/((0==r?1:1/r)+(0==t?1:1/t))},equivalence:function(t,r){return 1-Math.abs(r-t)},grainmerge:function(t,r){return t+r-.5},grainextract:function(t,r){return t-r+.5},addsubtract:function(t,r){return Math.abs(Math.sqrt(t)-Math.sqrt(r))},gammadark:function(t,r){return 0==r?0:Math.pow(t,1/r)},gammalight:function(t,r){return 0==t?0:Math.pow(r,1/t)},geometricmean:function(t,r){return Math.sqrt(t*r)},softlightsvg:function(t,r){return r>.5?t+(2*r-1)*((t>.25?Math.sqrt(t):((16*t-12)*t+4)*t)-t):t-(1-2*r)*t*(1-t)},overlay:function(t,r){return t>.5?1-2*(1-r)*(1-t):2*r*t},softlight:function(t,r){return.5>r?(1-2*r)*t*t+2*r*t:(1-(2*r-1))*t+(2*r-1)*Math.sqrt(t)},peglight:function(t,r){return(1-t)*t*r+t*(1-(1-t)*(1-r))},hardlight:function(t,r){return r>.5?1-2*(1-t)*(1-r):2*t*r},linearlight:function(t,r){return r>.5?t+2*(r-.5):t+2*r-1},vividlight:function(t,r){return.5>r?2*r==0?0:1-(1-t)/(2*r):2*(r-.5)==1?1:t/(1-2*(r-.5))},pinlight:function(t,r){return r>.5?Math.max(t,2*(r-.5)):Math.min(t,2*r)},reflect:function(t,r){return 1==r?1:t*t/(1-r)>1?1:t*t/(1-r)},glow:function(t,r){return 1==t?1:r*r/(1-t)>1?1:r*r/(1-t)},freeze:function(t,r){return 0==r?0:1-(1-t)*(1-t)/r},heat:function(t,r){return 0==t?0:1-(1-r)*(1-r)/t},interpolation:function(t,r){return.5-.25*Math.cos(Math.PI*t)-.25*Math.cos(Math.PI*r)},hardmix:function(t,r){return 1-r>t?0:1},binaryand:function(t,r){return(255&Math.round(255*t)&(255&Math.round(255*r)))/255},binaryor:function(t,r){return(255&Math.round(255*t)|255&Math.round(255*r))/255},binaryxor:function(t,r){return(255&Math.round(255*t)^255&Math.round(255*r))/255},binarynand:function(t,r){return(255&Math.round(255*t)&~(255&Math.round(255*r)))/255}},u={hslhue:function(t,r){var n=e.rgb2hsl([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsl([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsl2rgb([a[0],n[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hslsaturation:function(t,r){var n=e.rgb2hsl([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsl([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsl2rgb([n[0],a[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsllightness:function(t,r){var n=e.rgb2hsl([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsl([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsl2rgb([n[0],n[1],a[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsvhue:function(t,r){var n=e.rgb2hsv([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsv([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsv2rgb([a[0],n[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsvsaturation:function(t,r){var n=e.rgb2hsv([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsv([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsv2rgb([n[0],a[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsvvalue:function(t,r){var n=e.rgb2hsv([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsv([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsv2rgb([n[0],n[1],a[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hwbhue:function(t,r){var n=e.rgb2hwb([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hwb([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hwb2rgb([a[0],n[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hwbwhiteness:function(t,r){var n=e.rgb2hwb([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hwb([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hwb2rgb([n[0],a[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hwbblackness:function(t,r){var n=e.rgb2hwb([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hwb([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hwb2rgb([n[0],n[1],a[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},lablightness:function(t,r){var n=e.rgb2lab([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2lab([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.lab2rgb([a[0],n[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},labalpha:function(t,r){var n=e.rgb2lab([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2lab([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.lab2rgb([n[0],a[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},labbeta:function(t,r){var n=e.rgb2lab([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2lab([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.lab2rgb([n[0],n[1],a[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},lchlightness:function(t,r){var n=e.rgb2lch([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2lch([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.lch2rgb([a[0],n[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},lchchroma:function(t,r){var n=e.rgb2lch([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2lch([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.lch2rgb([n[0],a[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},lchhue:function(t,r){var n=e.rgb2lch([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2lch([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.lch2rgb([n[0],n[1],a[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsyhue:function(t,r){var n=e.rgb2hsy([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsy([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsy2rgb([a[0],n[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsysaturation:function(t,r){var n=e.rgb2hsy([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsy([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsy2rgb([n[0],a[1],n[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},hsyluma:function(t,r){var n=e.rgb2hsy([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2hsy([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.hsy2rgb([n[0],n[1],a[2]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},cmykcyan:function(t,r){var n=e.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.cmyk2rgb([a[0],n[1],n[2],n[3]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},cmykmagenta:function(t,r){var n=e.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.cmyk2rgb([n[0],a[1],n[2],n[3]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},cmykyellow:function(t,r){var n=e.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.cmyk2rgb([n[0],n[1],a[2],n[3]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}},cmykkey:function(t,r){var n=e.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=e.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),h=e.cmyk2rgb([n[0],n[1],n[2],a[3]]);return{r:h[0]/255,g:h[1]/255,b:h[2]/255}}};this.blend=function(t,r,n,a,i,g){null==a&&(a=1),null==n&&(n="normal"),null==g&&(g="clip"),n=n.toLowerCase(),g=g.toLowerCase();var b=h.normal,o=h.clip,c="b";null!=n&&(hasOwnProperty.call(h,n)?b=h[n]:hasOwnProperty.call(u,n)&&(b=u[n],c="m")),null!=g&&hasOwnProperty.call(h,g)&&(alphaBlendFunction=h[g]);var s=0,l=0,f=0;if(t instanceof Minerva.Img)s=3;else if(t instanceof Channel)s=2;else{if("number"!=typeof t)return;s=1}if(r instanceof Minerva.Img)l=3,null==i&&(i=r.getChannel("a"),f=1);else if(r instanceof Channel)l=2;else{if("number"!=typeof r)return;l=1}if(i instanceof Channel&&(f=1),1==s&&1==l){var m={},v=e.hex2rgb(t),M=e.hex2rgb(r);return m="b"==c?{r:b(v.r,M.r),g:b(v.g,M.g),b:b(v.b,M.b)}:b(v,M)}if((2==s||3==s)&&1==l){var d=new Minerva.Img;d.setSize(t.width,t.height);for(var w=0;w<t.width*t.height;w++){var m={},y={};y=2==s?{r:t.getAt(w),g:t.getAt(w),b:t.getAt(w)}:t.getColorAt(w);var A=e.hex2rgb(r);m="b"==c?{r:b(y.r,A.r),g:b(y.g,A.g),b:b(y.b,A.b)}:b(y,A);var p=1;if(1==f?p=i.getAt(w)*a:0==f&&(p=a),d.setColorAt(w,{r:p*m.r+(1-p)*y.r,g:p*m.g+(1-p)*y.g,b:p*m.b+(1-p)*y.b}),3==s){var x=o(t.getAlphaAt(w),1);d.setAlphaAt(w,x)}else d.setAlphaAt(w,1)}return d}if(1==s&&(2==l||3==l)){var d=new Minerva.Img;d.setSize(t.width,t.height);for(var w=0;w<t.width*t.height;w++){var m={},A={};A=2==l?{r:r.getAt(w),g:r.getAt(w),b:r.getAt(w)}:r.getColorAt(w);var y=e.hex2rgb(t);m="b"==c?{r:b(y.r,A.r),g:b(y.g,A.g),b:b(y.b,A.b)}:b(y,A);var p=1;if(1==f?p=i.getAt(w)*a:0==f&&(p=a),d.setColorAt(w,{r:p*m.r+(1-p)*y.r,g:p*m.g+(1-p)*y.g,b:p*m.b+(1-p)*y.b}),3==blenDataType){var x=o(t.getAlphaAt(w),1);d.setAlphaAt(w,x)}else d.setAlphaAt(w,1)}return d}if(!(2!=s&&3!=s||2!=l&&3!=l)&&t.width==r.width&&t.height==r.height){var d=new Minerva.Img;d.setSize(t.width,t.height);for(var w=0;w<t.width*t.height;w++){var m={},y={},A={};y=2==s?{r:t.getAt(w),g:t.getAt(w),b:t.getAt(w)}:t.getColorAt(w),A=2==l?{r:t.getAt(w),g:t.getAt(w),b:t.getAt(w)}:r.getColorAt(w),m="b"==c?{r:b(y.r,A.r),g:b(y.g,A.g),b:b(y.b,A.b)}:b(y,A);var p=1;1==f?p=i.getAt(w)*a:0==f&&(p=a),d.setColorAt(w,{r:p*m.r+(1-p)*y.r,g:p*m.g+(1-p)*y.g,b:p*m.b+(1-p)*y.b}),3==s&&3==l?d.setAlphaAt(w,o(t.getAlphaAt(w),r.getAlphaAt(w))):3==s?d.setAlphaAt(w,o(t.getAlphaAt(w),1)):3==l?d.setAlphaAt(w,o(1,r.getAlphaAt(w))):d.setAlphaAt(w,1)}return d}},this.getSupportedBlendmodes=function(){return Object.keys(h).concat(Object.keys(u))}};
