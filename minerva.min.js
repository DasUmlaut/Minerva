var Minerva=new function(){var t=[],n={};this.Utility={},this.Helper={setSeed:function(r){lib.seed=r},random:function(){lib.seed=(9301*lib.seed+49297)%233280;var r=lib.seed/233280;return r},permutate:function(r){var t=[],n=[];for(i=0;i<2*r;i++){var e=255&Math.round(255*helper.random());t[i]=e,n[i]=e%8}lib.perm=t.concat(t),lib.permMod8=n.concat(n)},grad2:function(r,t,n){var e=7&r,a=4>e?t:n,i=4>e?n:t;return(1&e?-a:a)+(2&e?-2*i:2*i)},fade:function(r){return r*r*r*(r*(6*r-15)+10)},lerp:function(r,t,n){return t+r*(n-t)}},this.Utility.getAverageTotal=function(r){if(r instanceof Minerva.Img){var t=0,n=0,e=0;for(i=0;i<r.width*r.height;i++){var a=r.getColorAt(i);t+=a.r,n+=a.g,e+=a.b}return{r:t/(r.width*r.height),g:n/(r.width*r.height),b:e/(r.width*r.height)}}},this.Utility.getAverageVisible=function(r){if(r instanceof Minerva.Img){var t=0,n=0,e=0,a=0;for(i=0;i<r.width*r.height;i++){var h=r.getColorAt(i),o=r.getAlphaAt(i);t+=h.r*o,n+=h.g*o,e+=h.b*o,a+=o.a}return{r:t/(r.width*r.height)/a,g:n/(r.width*r.height)/a,b:e/(r.width*r.height)/a}}},this.preload=function(r){if("string"==typeof r)t.push(r);else if(Array.isArray(r))for(var n=0;n<r.length;n++)t.push(r[n])},this.getPreloadedImages=function(){return n},this.onPreloaded=function(r){for(var e=0,a=function(){e++,e==t.length&&r()},i=0;i<t.length;i++){var h=new Image;h.addEventListener("load",a),h.src=t[i],n[t[i]]=h}},this.Channel=function(){var r=[];this.width=0,this.height=0,this.add=function(t){r.push(t)},this.set=function(t){t instanceof Minerva.Channel&&(r=t.get())},this.setAt=function(t,n){r[t]=n},this.get=function(){return r},this.getAt=function(t){return r[t]},this.setSize=function(r,t){this.width=r,this.height=t}},this.Img=function(r){this.getChannel=function(r){return"r"==r?t:"g"==r?n:"b"==r?e:"a"==r?a:void 0},this.setChannel=function(r,i){"r"==r?t=i:"g"==r?n=i:"b"==r?e=i:"a"==r&&(a=i)},this.setSize=function(r,i){this.width=r,this.height=i,t.setSize(r,i),n.setSize(r,i),e.setSize(r,i),a.setSize(r,i)},this.getColorAt=function(r){return{r:t.getAt(r),g:n.getAt(r),b:e.getAt(r)}},this.getAlphaAt=function(r){return a.getAt(r)},this.setColorAt=function(r,a){t.setAt(r,Math.min(1,Math.max(0,a.r))),n.setAt(r,Math.min(1,Math.max(0,a.g))),e.setAt(r,Math.min(1,Math.max(0,a.b)))},this.setAlphaAt=function(r,t){a.setAt(r,Math.min(1,Math.max(0,t)))},this.fromImage=function(r){this.width=r.width,this.height=r.height,t.setSize(r.width,r.height),n.setSize(r.width,r.height),e.setSize(r.width,r.height),a.setSize(r.width,r.height);var i=document.createElement("canvas");i.width=this.width,i.height=this.height;var h=i.getContext("2d");h.drawImage(r,0,0);for(var o=h.getImageData(0,0,this.width,this.height),g=0;g<o.data.length/4;g++)t.add(o.data[4*g+0]/255),n.add(o.data[4*g+1]/255),e.add(o.data[4*g+2]/255),a.add(o.data[4*g+3]/255)},this.fromUrl=function(r){var t=new Image;t.src=r,this.fromImage(t)},this.toCanvas=function(){var r=document.createElement("canvas");r.width=this.width,r.height=this.height;for(var i=r.getContext("2d"),h=i.createImageData(this.width,this.height),o=0;o<h.data.length/4;o++)h.data[4*o+0]=255*t.getAt(o)&255,h.data[4*o+1]=255*n.getAt(o)&255,h.data[4*o+2]=255*e.getAt(o)&255,h.data[4*o+3]=255*a.getAt(o)&255;return i.putImageData(h,0,0),r},this.toFileData=function(){var r=this.toCanvas(),t=r.toDataURL();return t.replace("data:image/png;baseData64,","")},this.width=0,this.height=0;var t=new Minerva.Channel,n=new Minerva.Channel,e=new Minerva.Channel,a=new Minerva.Channel;null==r||("string"==typeof r?this.fromUrl(r):r instanceof Image&&this.fromImage(r))};var e={lumaR:.3,lumaG:.59,lumaB:.11};this.Convert={hex2rgb:function(r){var t=r>>16&255,n=r>>8&255,e=255&r;return{r:t/255,g:n/255,b:e/255}},rgb2hsl:function(r){var t,n,e,a=r[0]/255,i=r[1]/255,h=r[2]/255,o=Math.min(a,i,h),g=Math.max(a,i,h),u=g-o;return g==o?t=0:a==g?t=(i-h)/u:i==g?t=2+(h-a)/u:h==g&&(t=4+(a-i)/u),t=Math.min(60*t,360),0>t&&(t+=360),e=(o+g)/2,n=g==o?0:.5>=e?u/(g+o):u/(2-g-o),[t,100*n,100*e]},rgb2hsv:function(r){var t,n,e,a=r[0],i=r[1],h=r[2],o=Math.min(a,i,h),g=Math.max(a,i,h),u=g-o;return n=0==g?0:u/g*1e3/10,g==o?t=0:a==g?t=(i-h)/u:i==g?t=2+(h-a)/u:h==g&&(t=4+(a-i)/u),t=Math.min(60*t,360),0>t&&(t+=360),e=g/255*1e3/10,[t,n,e]},rgb2hwb:function(r){var t=r[0],n=r[1],e=r[2],a=Minerva.Convert.rgb2hsl(r)[0],i=1/255*Math.min(t,Math.min(n,e)),e=1-1/255*Math.max(t,Math.max(n,e));return[a,100*i,100*e]},rgb2cmyk:function(r){var t,n,e,a,i=r[0]/255,h=r[1]/255,o=r[2]/255;return a=Math.min(1-i,1-h,1-o),t=(1-i-a)/(1-a)||0,n=(1-h-a)/(1-a)||0,e=(1-o-a)/(1-a)||0,[100*t,100*n,100*e,100*a]},rgb2xyz:function(r){var t=r[0]/255,n=r[1]/255,e=r[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92;var a=.4124*t+.3576*n+.1805*e,i=.2126*t+.7152*n+.0722*e,h=.0193*t+.1192*n+.9505*e;return[100*a,100*i,100*h]},rgb2lab:function(r){var t,n,e,a=Minerva.Convert.rgb2xyz(r),i=a[0],h=a[1],o=a[2];return i/=95.047,h/=100,o/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,h=h>.008856?Math.pow(h,1/3):7.787*h+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,t=116*h-16,n=500*(i-h),e=200*(h-o),[t,n,e]},rgb2lch:function(r){return Minerva.Convert.lab2lch(Minerva.Convert.rgb2lab(r))},hsl2rgb:function(r){var t,n,e,a,i,h=r[0]/360,o=r[1]/100,g=r[2]/100;if(0==o)return i=255*g&255,[i,i,i];n=.5>g?g*(1+o):g+o-g*o,t=2*g-n,a=[0,0,0];for(var u=0;3>u;u++)e=h+1/3*-(u-1),0>e&&e++,e>1&&e--,i=1>6*e?t+6*(n-t)*e:1>2*e?n:2>3*e?t+(n-t)*(2/3-e)*6:t,a[u]=255&Math.round(255*i);return a},hsl2hsv:function(r){var t,n,e=r[0],a=r[1]/100,i=r[2]/100;return i*=2,a*=1>=i?i:2-i,n=(i+a)/2,t=2*a/(i+a),[e,100*t,100*n]},hsl2hwb:function(r){return Minerva.Convert.rgb2hwb(Minerva.Convert.hsl2rgb(r))},hsl2cmyk:function(r){return Minerva.Convert.rgb2cmyk(Minerva.Convert.hsl2rgb(r))},hsv2rgb:function(r){var t=r[0]/60,n=r[1]/100,e=r[2]/100,a=Math.floor(t)%6,i=t-Math.floor(t),h=255*e*(1-n),o=255*e*(1-n*i),g=255*e*(1-n*(1-i)),e=255*e;switch(a){case 0:return[e,g,h];case 1:return[o,e,h];case 2:return[h,e,g];case 3:return[h,o,e];case 4:return[g,h,e];case 5:return[e,h,o]}},hsv2hsl:function(r){var t,n,e=r[0],a=r[1]/100,i=r[2]/100;return n=(2-a)*i,t=a*i,t/=1>=n?n:2-n,t=t||0,n/=2,[e,100*t,100*n]},hsv2hwb:function(r){return Minerva.Convert.rgb2hwb(Minerva.Convert.hsv2rgb(r))},hsv2cmyk:function(r){return Minerva.Convert.rgb2cmyk(Minerva.Convert.hsv2rgb(r))},hwb2rgb:function(t){var n,e,a,i,h=t[0]/360,o=t[1]/100,u=t[2]/100,v=o+u;switch(v>1&&(o/=v,u/=v),n=Math.floor(6*h),e=1-u,a=6*h-n,0!=(1&n)&&(a=1-a),i=o+a*(e-o),n){default:case 6:case 0:r=e,g=i,b=o;break;case 1:r=i,g=e,b=o;break;case 2:r=o,g=e,b=i;break;case 3:r=o,g=i,b=e;break;case 4:r=i,g=o,b=e;break;case 5:r=e,g=o,b=i}return[255&Math.round(255*r),255&Math.round(255*g),255&Math.round(255*b)]},hwb2hsl:function(r){return Minerva.Convert.rgb2hsl(Minerva.Convert.hwb2rgb(r))},hwb2hsv:function(r){return Minerva.Convert.rgb2hsv(Minerva.Convert.hwb2rgb(r))},hwb2cmyk:function(r){return Minerva.Convert.rgb2cmyk(Minerva.Convert.hwb2rgb(r))},cmyk2rgb:function(r){var t,n,e,a=r[0]/100,i=r[1]/100,h=r[2]/100,o=r[3]/100;return t=1-Math.min(1,a*(1-o)+o),n=1-Math.min(1,i*(1-o)+o),e=1-Math.min(1,h*(1-o)+o),[255&Math.round(255*t),255&Math.round(255*n),255&Math.round(255*e)]},cmyk2hsl:function(r){return Minerva.Convert.rgb2hsl(Minerva.Convert.cmyk2rgb(r))},cmyk2hsv:function(r){return Minerva.Convert.rgb2hsv(Minerva.Convert.cmyk2rgb(r))},cmyk2hwb:function(r){return Minerva.Convert.rgb2hwb(Minerva.Convert.cmyk2rgb(r))},xyz2rgb:function(r){var t,n,e,a=r[0]/100,i=r[1]/100,h=r[2]/100;return t=3.2406*a+-1.5372*i+h*-.4986,n=a*-.9689+1.8758*i+.0415*h,e=.0557*a+i*-.204+1.057*h,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:t=12.92*t,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n=12.92*n,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:e=12.92*e,t=Math.min(Math.max(0,t),1),n=Math.min(Math.max(0,n),1),e=Math.min(Math.max(0,e),1),[255&Math.round(255*t),255&Math.round(255*n),255&Math.round(255*e)]},xyz2lab:function(r){var t,n,e,a=r[0],i=r[1],h=r[2];return a/=95.047,i/=100,h/=108.883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,h=h>.008856?Math.pow(h,1/3):7.787*h+16/116,t=116*i-16,n=500*(a-i),e=200*(i-h),[t,n,e]},xyz2lch:function(r){return Minerva.Convert.lab2lch(Minerva.Convert.xyz2lab(r))},lab2xyz:function(r){var t,n,e,a,i=r[0],h=r[1],o=r[2];return 8>=i?(n=100*i/903.3,a=7.787*(n/100)+16/116):(n=100*Math.pow((i+16)/116,3),a=Math.pow(n/100,1/3)),t=.008856>=t/95.047?t=95.047*(h/500+a-16/116)/7.787:95.047*Math.pow(h/500+a,3),e=.008859>=e/108.883?e=108.883*(a-o/200-16/116)/7.787:108.883*Math.pow(a-o/200,3),[t,n,e]},lab2lch:function(r){var t,n,e,a=r[0],i=r[1],h=r[2];return t=Math.atan2(h,i),n=360*t/2/Math.PI,0>n&&(n+=360),e=Math.sqrt(i*i+h*h),[a,e,n]},lab2rgb:function(r){return Minerva.Convert.xyz2rgb(Minerva.Convert.lab2xyz(r))},lch2lab:function(r){var t,n,e,a=r[0],i=r[1],h=r[2];return e=h/360*2*Math.PI,t=i*Math.cos(e),n=i*Math.sin(e),[a,t,n]},lch2xyz:function(r){return Minerva.Convert.lab2xyz(Minerva.Convert.lch2lab(r))},lch2rgb:function(r){return Minerva.Convert.lab2rgb(Minerva.Convert.lch2lab(r))},rgb2hsy:function(r){var t=r[0]/255,n=r[1]/255,a=r[2]/255,i=0,h=0,o=t*e.lumaR+n*e.lumaG+a*e.lumaB;return t==n&&n==a||(t>=n&&n>=a?(h=t-a,i=1/6*(n-a)/h):n>t&&t>=a?(h=n-a,i=1/6*(n-t)/h+1/6):n>=a&&a>t?(h=n-t,i=1/6*(a-t)/h+2/6):a>n&&n>t?(h=a-t,i=1/6*(a-n)/h+.5):a>t&&t>=n?(h=a-n,i=1/6*(t-n)/h+4/6):(h=t-n,i=1/6*(t-a)/h+5/6)),[i,Math.min(Math.max(h,0),1),Math.min(Math.max(o,0),1)]},hsy2rgb:function(r){var t=0,n=0,a=0,i=0,h=r[0],o=r[1],g=r[2];return h>=0&&1/6>h?(i=o*h/(1/6),a=g-e.lumaR*o-e.lumaG*i,t=a+o,n=a+i):h>=1/6&&2/6>h?(i=o*(h-1/6)/(1/6),n=g+e.lumaB*o+e.lumaR*i,a=n-o,t=n-i):h>=2/6&&.5>h?(i=o*(h-2/6)/(1/6),t=g-e.lumaG*o-e.lumaB*i,n=t+o,a=t+i):h>=.5&&4/6>h?(i=o*(h-.5)/(1/6),a=g+e.lumaR*o+e.lumaG*i,t=a-o,n=a-i):h>=4/6&&5/6>h?(i=o*(h-4/6)/(1/6),n=g-e.lumaB*o-e.lumaR*i,a=n+o,t=n+i):(i=o*(h-5/6)/(1/6),t=g+e.lumaG*o+e.lumaB*i,n=t-o,a=t-i),t=Math.max(0,Math.min(1,t)),n=Math.max(0,Math.min(1,n)),a=Math.max(0,Math.min(1,a)),[255&Math.round(255*t),255&Math.round(255*n),255&Math.round(255*a)]}};var a={normal:function(r,t){return t},ignore:function(r){return r},clip:function(r){return r},replace:function(r,t){return t},discard:function(){return 1},average:function(r,t){return(r+t)/2},stamp:function(r,t){return r+2*t-1},punch:function(r,t){return t+2*r-1},darken:function(r,t){return Math.min(r,t)},multiply:function(r,t){return r*t},colorburn:function(r,t){return 0==t?0:1-(1-r)/t},linearburn:function(r,t){return r+t-1},softburn:function(r,t){return 1>t+r?1==r?1:t/2/(1-r):0==t?0:1-(1-r)/2/t},lighten:function(r,t){return Math.max(r,t)},screen:function(r,t){return 1-(1-r)*(1-t)},lineardodge:function(r,t){return Math.min(1,r+t)},colordodge:function(r,t){return 1==t?1:r/(1-t)},softdodge:function(r,t){return 1>=r+t?1==t?1:r/2/(1-t):1-(1-t)/2/r},difference:function(r,t){return Math.abs(r-t)},negation:function(r,t){return 1-Math.abs(1-r-t)},exclusion:function(r,t){return r+t-2*r*t},divide:function(r,t){return 0==t?0:r/t},subtract:function(r,t){return Math.max(0,Math.min(1,r-t))},phoenix:function(r,t){return Math.min(r,t)-Math.max(r,t)+1},inversesubtract:function(r,t){return t-(1-r)},arctangent:function(r,t){return 0==r?0==t?0:1:2*Math.atan(t/r)/Math.PI},parallel:function(r,t){return 2/((0==t?1:1/t)+(0==r?1:1/r))},equivalence:function(r,t){return 1-Math.abs(t-r)},grainmerge:function(r,t){return r+t-.5},grainextract:function(r,t){return r-t+.5},addsubtract:function(r,t){return Math.abs(Math.sqrt(r)-Math.sqrt(t))},gammadark:function(r,t){return 0==t?0:Math.pow(r,1/t)},gammalight:function(r,t){return 0==r?0:Math.pow(t,1/r)},geometricmean:function(r,t){return Math.sqrt(r*t)},softlightsvg:function(r,t){return t>.5?r+(2*t-1)*((r>.25?Math.sqrt(r):((16*r-12)*r+4)*r)-r):r-(1-2*t)*r*(1-r)},overlay:function(r,t){return r>.5?1-2*(1-t)*(1-r):2*t*r},softlight:function(r,t){return.5>t?(1-2*t)*r*r+2*t*r:(1-(2*t-1))*r+(2*t-1)*Math.sqrt(r)},peglight:function(r,t){return(1-r)*r*t+r*(1-(1-r)*(1-t))},hardlight:function(r,t){return t>.5?1-2*(1-r)*(1-t):2*r*t},linearlight:function(r,t){return t>.5?r+2*(t-.5):r+2*t-1},vividlight:function(r,t){return.5>t?2*t==0?0:1-(1-r)/(2*t):2*(t-.5)==1?1:r/(1-2*(t-.5))},pinlight:function(r,t){return t>.5?Math.max(r,2*(t-.5)):Math.min(r,2*t)},reflect:function(r,t){return 1==t?1:r*r/(1-t)>1?1:r*r/(1-t)},glow:function(r,t){return 1==r?1:t*t/(1-r)>1?1:t*t/(1-r)},freeze:function(r,t){return 0==t?0:1-(1-r)*(1-r)/t},heat:function(r,t){return 0==r?0:1-(1-t)*(1-t)/r},interpolation:function(r,t){return.5-.25*Math.cos(Math.PI*r)-.25*Math.cos(Math.PI*t)},hardmix:function(r,t){return 1-t>r?0:1},binaryand:function(r,t){return(255&Math.round(255*r)&(255&Math.round(255*t)))/255},binaryor:function(r,t){return(255&Math.round(255*r)|255&Math.round(255*t))/255},binaryxor:function(r,t){return(255&Math.round(255*r)^255&Math.round(255*t))/255},binarynand:function(r,t){return(255&Math.round(255*r)&~(255&Math.round(255*t)))/255}},h={hslhue:function(r,t){var n=Minerva.Convert.rgb2hsl([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsl([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsl2rgb([e[0],n[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hslsaturation:function(r,t){var n=Minerva.Convert.rgb2hsl([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsl([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsl2rgb([n[0],e[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsllightness:function(r,t){var n=Minerva.Convert.rgb2hsl([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsl([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsl2rgb([n[0],n[1],e[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsvhue:function(r,t){var n=Minerva.Convert.rgb2hsv([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsv([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsv2rgb([e[0],n[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsvsaturation:function(r,t){var n=Minerva.Convert.rgb2hsv([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsv([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsv2rgb([n[0],e[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsvvalue:function(r,t){var n=Minerva.Convert.rgb2hsv([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsv([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsv2rgb([n[0],n[1],e[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hwbhue:function(r,t){var n=Minerva.Convert.rgb2hwb([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hwb([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hwb2rgb([e[0],n[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hwbwhiteness:function(r,t){var n=Minerva.Convert.rgb2hwb([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hwb([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hwb2rgb([n[0],e[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hwbblackness:function(r,t){var n=Minerva.Convert.rgb2hwb([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hwb([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hwb2rgb([n[0],n[1],e[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},lablightness:function(r,t){var n=Minerva.Convert.rgb2lab([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2lab([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.lab2rgb([e[0],n[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},labalpha:function(r,t){var n=Minerva.Convert.rgb2lab([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2lab([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.lab2rgb([n[0],e[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},labbeta:function(r,t){var n=Minerva.Convert.rgb2lab([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2lab([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.lab2rgb([n[0],n[1],e[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},lchlightness:function(r,t){var n=Minerva.Convert.rgb2lch([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2lch([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.lch2rgb([e[0],n[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},lchchroma:function(r,t){var n=Minerva.Convert.rgb2lch([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2lch([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.lch2rgb([n[0],e[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},lchhue:function(r,t){var n=Minerva.Convert.rgb2lch([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2lch([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.lch2rgb([n[0],n[1],e[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsyhue:function(r,t){var n=Minerva.Convert.rgb2hsy([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsy([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsy2rgb([e[0],n[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsysaturation:function(r,t){var n=Minerva.Convert.rgb2hsy([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsy([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsy2rgb([n[0],e[1],n[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},hsyluma:function(r,t){var n=Minerva.Convert.rgb2hsy([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2hsy([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.hsy2rgb([n[0],n[1],e[2]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},cmykcyan:function(r,t){var n=Minerva.Convert.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.cmyk2rgb([e[0],n[1],n[2],n[3]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},cmykmagenta:function(r,t){var n=Minerva.Convert.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.cmyk2rgb([n[0],e[1],n[2],n[3]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},cmykyellow:function(r,t){var n=Minerva.Convert.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.cmyk2rgb([n[0],n[1],e[2],n[3]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}},cmykkey:function(r,t){var n=Minerva.Convert.rgb2cmyk([255*r.r&255,255*r.g&255,255*r.b&255]),e=Minerva.Convert.rgb2cmyk([255*t.r&255,255*t.g&255,255*t.b&255]),a=Minerva.Convert.cmyk2rgb([n[0],n[1],n[2],e[3]]);return{r:a[0]/255,g:a[1]/255,b:a[2]/255}}};this.blend=function(r,t,n,e,i,o){null==e&&(e=1),null==n&&(n="normal"),null==o&&(o="clip"),n=n.toLowerCase(),o=o.toLowerCase();var g=a.normal,u=a.clip,v="b";null!=n&&(hasOwnProperty.call(a,n)?g=a[n]:hasOwnProperty.call(h,n)&&(g=h[n],v="m")),null!=o&&hasOwnProperty.call(a,o)&&(alphaBlendFunction=a[o]);var b=0,c=0,s=0;if(r instanceof Minerva.Img)b=3;else if(r instanceof Channel)b=2;else{if("number"!=typeof r)return;b=1}if(t instanceof Minerva.Img)c=3,null==i&&(i=t.getChannel("a"),s=1);else if(t instanceof Channel)c=2;else{if("number"!=typeof t)return;c=1}if(i instanceof Channel&&(s=1),1==b&&1==c){var l={},M=Minerva.Convert.hex2rgb(r),f=Minerva.Convert.hex2rgb(t);return l="b"==v?{r:g(M.r,f.r),g:g(M.g,f.g),b:g(M.b,f.b)}:g(M,f)}if((2==b||3==b)&&1==c){var m=new Minerva.Img;m.setSize(r.width,r.height);for(var C=0;C<r.width*r.height;C++){var l={},d={};d=2==b?{r:r.getAt(C),g:r.getAt(C),b:r.getAt(C)}:r.getColorAt(C);var w=Minerva.Convert.hex2rgb(t);l="b"==v?{r:g(d.r,w.r),g:g(d.g,w.g),b:g(d.b,w.b)}:g(d,w);var y=1;if(1==s?y=i.getAt(C)*e:0==s&&(y=e),m.setColorAt(C,{r:y*l.r+(1-y)*d.r,g:y*l.g+(1-y)*d.g,b:y*l.b+(1-y)*d.b}),3==b){var A=u(r.getAlphaAt(C),1);m.setAlphaAt(C,A)}else m.setAlphaAt(C,1)}return m}if(1==b&&(2==c||3==c)){var m=new Minerva.Img;m.setSize(r.width,r.height);for(var C=0;C<r.width*r.height;C++){var l={},w={};w=2==c?{r:t.getAt(C),g:t.getAt(C),b:t.getAt(C)}:t.getColorAt(C);var d=Minerva.Convert.hex2rgb(r);l="b"==v?{r:g(d.r,w.r),g:g(d.g,w.g),b:g(d.b,w.b)}:g(d,w);var y=1;if(1==s?y=i.getAt(C)*e:0==s&&(y=e),m.setColorAt(C,{r:y*l.r+(1-y)*d.r,g:y*l.g+(1-y)*d.g,b:y*l.b+(1-y)*d.b}),3==blenDataType){var A=u(r.getAlphaAt(C),1);m.setAlphaAt(C,A)}else m.setAlphaAt(C,1)}return m}if(!(2!=b&&3!=b||2!=c&&3!=c)&&r.width==t.width&&r.height==t.height){var m=new Minerva.Img;m.setSize(r.width,r.height);for(var C=0;C<r.width*r.height;C++){var l={},d={},w={};d=2==b?{r:r.getAt(C),g:r.getAt(C),b:r.getAt(C)}:r.getColorAt(C),w=2==c?{r:r.getAt(C),g:r.getAt(C),b:r.getAt(C)}:t.getColorAt(C),l="b"==v?{r:g(d.r,w.r),g:g(d.g,w.g),b:g(d.b,w.b)}:g(d,w);var y=1;1==s?y=i.getAt(C)*e:0==s&&(y=e),m.setColorAt(C,{r:y*l.r+(1-y)*d.r,g:y*l.g+(1-y)*d.g,b:y*l.b+(1-y)*d.b}),3==b&&3==c?m.setAlphaAt(C,u(r.getAlphaAt(C),t.getAlphaAt(C))):3==b?m.setAlphaAt(C,u(r.getAlphaAt(C),1)):3==c?m.setAlphaAt(C,u(1,t.getAlphaAt(C))):m.setAlphaAt(C,1)}return m}},this.getSupportedBlendmodes=function(){return Object.keys(a).concat(Object.keys(h))}};
